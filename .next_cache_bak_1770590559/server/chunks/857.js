"use strict";exports.id=857,exports.ids=[857],exports.modules={2704:(e,t,s)=>{s.d(t,{wx:()=>p,Di:()=>m,W3:()=>x,LF:()=>h,gm:()=>u,Ri:()=>o});var n=s(326),r=s(7577),l=s.n(r),i=s(579),a=s(7451);function d({value:e,onChange:t,className:s=""}){let l=r.useRef(null);return r.useEffect(()=>{l.current&&(l.current.style.height="0px",l.current.style.height=`${l.current.scrollHeight}px`)},[e]),n.jsx("textarea",{ref:l,value:e,onChange:e=>t(e.target.value),className:"w-full resize-none rounded-xl border border-zinc-800 bg-black/60 px-3 py-2 text-sm text-white outline-none focus:border-amber-500/80 font-semibold leading-5 "+s,placeholder:"e.g.\n3x Amuse\nS1 feijoa"})}var c=s(2854);function o(e){let t=parseInt(e.replace(/[^\d]/g,""),10);return Number.isFinite(t)?t:9999}function x(e){return!!e&&Object.values(e).some(e=>(e||"").trim().length>0)}function u(e){return Object.entries(e||{}).map(([e,t])=>({seat:Number(e),text:(t||"").trim()})).filter(e=>e.text.length>0).sort((e,t)=>e.seat-t.seat)}function b(e){return(e||"").trim().toLowerCase()}function h(e){let t=(e?.courseLines??[]).filter(e=>"FIRED"===e.status&&"number"==typeof e.firedAt).map(e=>e.firedAt);return 0===t.length?null:Math.min(...t)}function m(e,t){let s={...e.seatDish||{}},n=e.seatSubs||{};for(let e=1;e<=t;e++){let t=(n[e]||"").trim();t&&(s[e]=t)}let r=[];for(let e=1;e<=t;e++){let t=(s[e]||"").trim();t&&r.push({seat:e,dish:t,key:b(t)})}if(0===r.length)return{baseDish:e.name,baseCount:t,exceptions:[]};let l=new Map;for(let e of r)l.set(e.key,(l.get(e.key)||0)+1);let i=r[0].key,a=l.get(i)||1;for(let[e,t]of l.entries())t>a&&(i=e,a=t);return{baseDish:r.find(e=>e.key===i)?.dish||r[0].dish,baseCount:a,exceptions:r.filter(e=>e.key!==i).map(({seat:e,dish:t})=>({seat:e,dish:t}))}}function p({table:e,markDone:t,now:s,pauseNeedsAttention:r=!1,onAcknowledgePause:i,mode:o="KDS",editMode:x,onToggleEdit:b,onEditCourseText:m,onMoveCourse:p,onDeleteCourse:g,onAddCourse:N,guestSubs:j,guestSeatMap:v,labelMode:k}){let{t:z}=(0,c.Q)(),y=e.setup,E=s??Date.now(),D="KDS"===o&&!!t,w=l().useRef(null),S=l().useRef(null),R=l().useRef({}),I=u(y.allergiesBySeat),O=I.length>0,L=!!y.paused,C=(y?.courseLines??[]).reduce((e,t)=>e+(t.refireCount??0),0),M=h(y),F=M?Math.max(0,Math.floor((E-M)/6e4)):null,$=(y?.courseLines??[]).filter(e=>"FIRED"===e.status).length,A=(y?.courseLines??[]).filter(e=>"DONE"===e.status).length,P=(y?.courseLines??[]).length,U=function(e){let t=e?.courseLines??[];if(0===t.length)return null;let s=[...t].reverse().find(e=>"FIRED"===e.status);if(s&&"number"==typeof s.idx)return s.idx;let n=t.find(e=>"PENDING"===e.status);return n&&"number"==typeof n.idx?n.idx:null}(y),T=y.courseLines,G=T.filter(e=>"FIRED"===e.status),W=G[0]||null,K=T.find(e=>"PENDING"===e.status)||null,X=function(e){if(!e||0===e.length)return null;let t=[...e].reverse().find(e=>"FIRED"===e.status);if(t&&"number"==typeof t.idx)return t.idx;let s=e.find(e=>"PENDING"===e.status);return s&&"number"==typeof s.idx?s.idx:null}(T),_=G.length,B=G[G.length-1]||null,H=B?.firedAt?Math.max(0,Math.floor((E-B.firedAt)/6e4)):null,Q=!!x&&!!m&&!!p&&!!g&&!!N,V=k||"approval";return(0,n.jsxs)("div",{className:"w-[360px] h-[calc(100vh-220px)] bg-white text-black rounded-sm shadow-2xl border border-zinc-300 overflow-hidden font-mono flex flex-col",children:[n.jsx("div",{className:"h-2 bg-zinc-200",style:{clipPath:"polygon(0% 100%, 4% 0%, 8% 100%, 12% 0%, 16% 100%, 20% 0%, 24% 100%, 28% 0%, 32% 100%, 36% 0%, 40% 100%, 44% 0%, 48% 100%, 52% 0%, 56% 100%, 60% 0%, 64% 100%, 68% 0%, 72% 100%, 76% 0%, 80% 100%, 84% 0%, 88% 100%, 92% 0%, 96% 100%, 100% 0%)"}}),n.jsx("div",{className:"p-4 border-b border-zinc-300 sticky top-0 bg-white z-20",children:(0,n.jsxs)("div",{className:"flex items-start justify-between gap-3",children:[(0,n.jsxs)("div",{className:"min-w-0",children:[(0,n.jsxs)("div",{className:"flex items-center gap-2",children:[n.jsx("div",{className:"text-3xl font-black tracking-tight",children:e.name}),e.tableLanguage?n.jsx("div",{className:"ml-2 px-2 py-1 rounded-lg border border-zinc-800 bg-black/40 text-[10px] font-black text-zinc-200",children:e.tableLanguage}):null]}),(0,n.jsxs)("div",{className:"text-xs mt-1 text-zinc-700",children:[e.pax," PAX • ",e.reservationName||"—"," • ",e.language||"—"]}),null!==X||K?(0,n.jsxs)("div",{className:"mt-2 text-[11px] text-zinc-800",children:[n.jsx("span",{className:"font-black",children:"ON:"})," ",null!==X?`#${X}`:"—",K?(0,n.jsxs)("span",{className:"text-zinc-600",children:[" • Next: #",K.idx]}):null]}):null,_>0?(0,n.jsxs)("div",{className:"mt-1 text-[11px] text-zinc-800",children:[n.jsx("span",{className:"font-black",children:"FIRED:"})," ",_," active",null!==H?(0,n.jsxs)("span",{className:"text-zinc-600",children:[" • Last: ",H,"m"]}):null,C>0?(0,n.jsxs)("span",{className:"text-zinc-600",children:[" • Refire: ",C]}):null]}):null,(0,n.jsxs)("div",{className:"text-[10px] mt-1 text-zinc-700 font-black tracking-widest",children:[null!==U?`${z("ON COURSE","ON COURSE")} #${U}`:`${z("ON COURSE","ON COURSE")} —`,null!==F?` • ${z("FIRED","FIRED")} ${F}m`:` • ${z("FIRED","FIRED")} —`,` • ${z("FIRED","FIRED")} ${$} • ${z("DONE","DONE")} ${A}/${P}`]}),y.chefNote?.trim()?(0,n.jsxs)("div",{className:"mt-2 border border-zinc-300 bg-zinc-50 p-2",children:[n.jsx("div",{className:"text-[10px] font-black tracking-widest text-zinc-700 mb-1",children:"CHEF NOTE"}),n.jsx("div",{className:"text-[11px] text-zinc-800",children:y.chefNote})]}):null]}),(0,n.jsxs)("div",{className:"flex flex-col items-end gap-2 shrink-0",children:["KDS"===o?n.jsx("button",{onClick:()=>S.current?.scrollIntoView({behavior:"smooth",block:"start"}),className:"px-3 py-2 rounded-xl border border-zinc-300 bg-white text-xs font-black text-zinc-900 hover:bg-zinc-100",children:"JUMP NOW"}):null,b?n.jsx("button",{onClick:b,className:"px-3 py-2 rounded-xl border border-zinc-300 bg-white text-xs font-black text-zinc-900 hover:bg-zinc-100",children:x?"DONE":"EDIT"}):null,(0,n.jsxs)("span",{className:"text-[10px] font-black px-2 py-1 border border-zinc-400 bg-zinc-50 text-zinc-800",children:[z("MENU","MENU")," ",a.F(y.menuId)?.label||z("Menu","Menu")]}),y.pairing?n.jsx("div",{className:"ml-2 px-2 py-1 rounded-lg border border-indigo-700 bg-indigo-50 text-[10px] font-black text-indigo-700",children:z("SLOW PACE","SLOW PACE")}):null,O&&n.jsx("span",{className:"text-[10px] font-black px-2 py-1 border border-red-600 bg-red-50 text-red-700",children:z("ALLERGY","ALLERGY")}),L?D&&i?n.jsx("button",{type:"button",onClick:i,className:["ml-2 px-2 py-1 rounded-lg border border-red-700 bg-red-50 text-[10px] font-black text-red-700",r?"animate-pulse":""].join(" "),title:r?"Tap to acknowledge pause":"Pause acknowledged",children:z("PAUSED","PAUSED")}):n.jsx("div",{className:"ml-2 px-2 py-1 rounded-lg border border-red-700 bg-red-50 text-[10px] font-black text-red-700",children:z("PAUSED","PAUSED")}):null]})]})}),(0,n.jsxs)("div",{className:"p-3 overflow-y-auto",children:[I.length>0&&(0,n.jsxs)("div",{className:"mb-3 border border-zinc-300 bg-zinc-50 p-2",children:[n.jsx("div",{className:"text-[10px] font-black tracking-widest text-zinc-700 mb-1",children:z("SEAT NOTES","SEAT NOTES")}),n.jsx("div",{className:"text-[11px] text-zinc-800 space-y-1",children:I.map(e=>(0,n.jsxs)("div",{children:[(0,n.jsxs)("span",{className:"font-black",children:[z("Seat","Seat")," ",e.seat,":"]})," ",e.text]},e.seat))})]}),W&&!Q?(0,n.jsxs)("div",{className:"mt-3 rounded-xl border border-zinc-300 bg-white p-3",children:[n.jsx("div",{className:"text-[10px] font-black tracking-widest text-zinc-600",children:z("NOW","NOW")}),n.jsx(f,{course:W,onDone:D?()=>t?.(e.id,W.id):void 0,doneLock:R,now:E,nextPendingId:null,pax:e.pax,extras:y.extrasByCourseId?.[W.id]||[],mode:o,guestSubs:j,guestSeatMap:v,labelMode:V})]}):Q?null:(0,n.jsxs)("div",{className:"mt-3 rounded-xl border border-zinc-300 bg-white p-3",children:[n.jsx("div",{className:"text-[10px] font-black tracking-widest text-zinc-600",children:z("NOW","NOW")}),n.jsx("div",{className:"text-sm text-zinc-500",children:z("Nothing fired.","Nothing fired.")})]}),(0,n.jsxs)("div",{className:"mt-3 rounded-xl border border-zinc-200 bg-zinc-50 overflow-hidden",children:[(0,n.jsxs)("div",{className:"px-3 py-2 border-b border-zinc-200 flex items-center justify-between",children:[n.jsx("div",{className:"text-[10px] font-black tracking-widest text-zinc-600",children:z("FULL MENU","FULL MENU")}),(0,n.jsxs)("div",{className:"text-[10px] font-black text-zinc-500",children:[T.length," ",z("courses","courses")]})]}),n.jsx("div",{ref:w,className:"max-h-[520px] overflow-y-auto",children:n.jsx("div",{className:"p-3 space-y-2",children:T.map(s=>n.jsx("div",{ref:"FIRED"===s.status?S:void 0,className:["rounded-lg border p-2","FIRED"===s.status?"border-amber-400 bg-amber-50":"border-zinc-200 bg-white"].join(" "),children:Q?(0,n.jsxs)("div",{children:[n.jsx(d,{value:s.displayText||s.name||"",onChange:e=>m?.(s.id,e)}),(0,n.jsxs)("div",{className:"mt-2 flex gap-2",children:[n.jsx("button",{onClick:()=>p?.(s.id,-1),className:"px-3 py-2 rounded-xl text-xs font-black border border-zinc-300 bg-white text-zinc-900 hover:bg-zinc-100",children:"↑"}),n.jsx("button",{onClick:()=>p?.(s.id,1),className:"px-3 py-2 rounded-xl text-xs font-black border border-zinc-300 bg-white text-zinc-900 hover:bg-zinc-100",children:"↓"}),n.jsx("button",{onClick:()=>g?.(s.id),className:"px-3 py-2 rounded-xl text-xs font-black border border-red-400 bg-red-50 text-red-800 hover:bg-red-100",children:"DELETE"}),n.jsx("button",{onClick:()=>N?.(s.id),className:"px-3 py-2 rounded-xl text-xs font-black border border-amber-400 bg-amber-50 text-amber-900 hover:bg-amber-100",children:"+ ADD"})]})]}):n.jsx(f,{course:s,onDone:D?()=>t?.(e.id,s.id):void 0,doneLock:R,now:E,nextPendingId:null,pax:e.pax,extras:y.extrasByCourseId?.[s.id]||[],mode:o,guestSubs:j,guestSeatMap:v,labelMode:V})},s.id))})})]})]}),n.jsx("div",{className:"h-2 bg-white border-t border-zinc-200",style:{clipPath:"polygon(0% 0%, 4% 100%, 8% 0%, 12% 100%, 16% 0%, 20% 100%, 24% 0%, 28% 100%, 32% 0%, 36% 100%, 40% 0%, 44% 100%, 48% 0%, 52% 100%, 56% 0%, 60% 100%, 64% 0%, 68% 100%, 72% 0%, 76% 100%, 80% 0%, 84% 100%, 88% 0%, 92% 100%, 96% 0%, 100% 100%)"}})]})}function f({course:e,onDone:t,doneLock:s,now:r,nextPendingId:a,pax:d,extras:o,mode:x="KDS",guestSubs:u,guestSeatMap:h,labelMode:p="approval"}){let{t:f}=(0,c.Q)(),g="FIRED"===e.status,N="DONE"===e.status,j="PENDING"===e.status&&a===e.id,v=g&&e.firedAt?Math.max(0,Math.floor((r-e.firedAt)/6e4)):null,k=e.refireCount??0,{baseDish:z,baseCount:y,exceptions:E}=m(e,d),D=(u||[]).filter(t=>t.courseId===e.id),w=Array.from(new Set(D.map(e=>e.guest))).length,S=l().useMemo(()=>{let e=new Set;if(!D.length)return e;let t=(0,i.NK)(d),s=e=>{let s=h?.[e];if(s&&s>=1)return s;let n=t.indexOf(e);return n>=0?n+1:null};for(let t of D){let n=s(t.guest);n&&e.add(n)}return e},[D,h,d]),R=function(e,t,s,n){let r={...e.seatDish||{}},l=[];for(let e=1;e<=t;e++){let t=(r[e]||"").trim();t&&l.push({seat:e,dish:t,key:b(t)})}if(0===l.length)return{baseDish:e.name,baseCount:t,guestLines:[]};let a=new Map;for(let e of l)a.set(e.key,(a.get(e.key)||0)+1);let d=l[0].key,c=a.get(d)||1;for(let[e,t]of a.entries())t>c&&(d=e,c=t);let o=l.find(e=>e.key===d)?.dish||l[0].dish,x={},u=(0,i.NK)(t);for(let e=1;e<=t;e++){let t=u[e-1];x[e]=t?`Guest ${t}`:`Seat ${e}`}s&&Object.entries(s).forEach(([e,s])=>{s&&s>=1&&s<=t&&(x[s]=`Guest ${e}`)});let h=l.filter(e=>e.key!==d&&!n?.has(e.seat)),m=Math.max(0,t-h.length),p=new Map;for(let e of h){let t=x[e.seat],s=p.get(e.dish)||[];s.push(t),p.set(e.dish,s)}return{baseDish:o,baseCount:m,guestLines:Array.from(p.entries()).map(([e,t])=>({label:t.join(" & "),dish:e}))}}(e,d,h,S),I=Object.entries(e.seatSubs||{}).map(([e,t])=>({seat:Number(e),text:(t||"").trim()})).filter(e=>e.text.length>0).sort((e,t)=>e.seat-t.seat),O=new Set(E.map(e=>e.seat)),L=I.filter(e=>!O.has(e.seat)),C="draft"===p,M="draft"!==p,F=l().useCallback(()=>{if(!t)return;let n=e.id,r=s.current[n]||0,l=Date.now();l-r<900||(s.current[n]=l,t())},[e.id,s,t]),$="PREVIEW"===x,A=(e.displayText||"").split("\n"),P=(A[0]||"").trim(),U=A.slice(1).map(e=>e.trim()).filter(e=>e.length>0);return n.jsx("div",{className:["py-1 px-2 -mx-2 rounded",g?"bg-orange-50 border border-orange-200":"",j?"border border-zinc-400 bg-zinc-50":"",N?"opacity-40":"PENDING"===e.status?"opacity-85":""].join(" "),children:(0,n.jsxs)("div",{className:"flex items-start justify-between gap-3",children:[(0,n.jsxs)("div",{className:"min-w-0",children:[(0,n.jsxs)("div",{className:"flex items-baseline gap-2 flex-wrap",children:[(0,n.jsxs)("div",{className:"text-xs font-black w-8 text-right",children:[e.idx,"."]}),n.jsx("div",{className:["text-sm font-bold truncate",N?"line-through text-zinc-500":""].join(" "),children:P||`${Math.max(0,(C?R.baseCount:y)-(C?w:0))}x ${C&&R.baseDish||z}`}),g&&n.jsx("span",{className:"text-[10px] font-black px-2 py-0.5 border border-orange-600 bg-white text-orange-800",children:f("FIRED","FIRED")}),j&&n.jsx("span",{className:"text-[10px] font-black px-2 py-0.5 border border-zinc-500 bg-white text-zinc-700",children:f("NEXT","NEXT")}),N&&n.jsx("span",{className:"text-[10px] font-black px-2 py-0.5 border border-green-700 bg-white text-green-800",children:f("DONE","DONE")}),g&&null!==v&&(0,n.jsxs)("span",{className:"text-[10px] font-black px-2 py-0.5 border border-zinc-400 bg-white text-zinc-700",children:[v,"m"]}),g&&k>0&&(0,n.jsxs)("span",{className:"text-[10px] font-black px-2 py-0.5 border border-orange-600 bg-white text-orange-800",children:["REFIRE x",k]})]}),U.length>0?n.jsx("div",{className:"mt-1 space-y-1",children:U.map((t,s)=>n.jsx("div",{className:"text-xs text-zinc-300 font-semibold",children:t},`${e.id}_dl_${s}`))}):null,C&&R.guestLines.length>0?n.jsx("div",{className:"mt-1 text-[11px] text-zinc-700 space-y-0.5",children:R.guestLines.map((t,s)=>(0,n.jsxs)("div",{className:"font-black",children:[t.label," — ",t.dish]},`${e.id}_gmenu_${s}`))}):null,E.length>0&&M?n.jsx("div",{className:["mt-1 text-[11px] space-y-0.5",$?"text-amber-800":"text-zinc-700"].join(" "),children:E.map(e=>(0,n.jsxs)("div",{className:$?"font-black":"",children:[(0,n.jsxs)("span",{className:"font-black",children:[f("Seat","Seat")," ",e.seat," →"]})," ",e.dish]},e.seat))}):null,C&&D.length>0?n.jsx("div",{className:"mt-1 text-[11px] text-zinc-700 space-y-0.5",children:D.map(e=>(0,n.jsxs)("div",{className:"font-black",children:[f("Guest","Guest")," ",e.guest," — ",e.text]},e.id))}):M&&L.length>0?n.jsx("div",{className:["mt-1 text-[11px] space-y-0.5",$?"text-amber-800":"text-zinc-700"].join(" "),children:L.map(e=>(0,n.jsxs)("div",{className:[N?"line-through text-zinc-500":"",$?"font-black":""].join(" "),children:[(0,n.jsxs)("span",{className:"font-black",children:[f("Seat","Seat")," ",e.seat," →"]})," ",f("Substitute","Substitute"),": ",e.text]},e.seat))}):null,o.length>0&&n.jsx("div",{className:"mt-1 text-[11px] text-zinc-800 space-y-0.5",children:o.map((e,t)=>(0,n.jsxs)("div",{children:[(0,n.jsxs)("span",{className:"font-black",children:[f("EXTRA","EXTRA"),":"]})," ",e]},`${e}_${t}`))})]}),n.jsx("div",{className:"shrink-0",children:"KDS"===x?n.jsx("button",{disabled:!g,onClick:F,className:["px-4 py-3 rounded-2xl border text-sm font-black transition",g?"border-zinc-300 bg-white text-zinc-900 hover:bg-zinc-100":"border-zinc-300 bg-zinc-100 text-zinc-400 cursor-not-allowed"].join(" "),children:f("DONE","DONE")}):null})]})})}},7481:(e,t,s)=>{s.r(t),s.d(t,{default:()=>r});var n=s(6621);let r=e=>[{type:"image/x-icon",sizes:"16x16",url:(0,n.fillMetadataSegment)(".",e.params,"favicon.ico")+""}]}};