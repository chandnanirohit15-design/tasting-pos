"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[376],{5376:function(e,t,n){n.d(t,{wx:function(){return m},Di:function(){return h},W3:function(){return o},LF:function(){return b},gm:function(){return x},Ri:function(){return d}});var l=n(7437),s=n(2265),r=n(4310),i=n(7188);function a(e){let{value:t,onChange:n,className:r=""}=e,i=s.useRef(null);return s.useEffect(()=>{i.current&&(i.current.style.height="0px",i.current.style.height="".concat(i.current.scrollHeight,"px"))},[t]),(0,l.jsx)("textarea",{ref:i,value:t,onChange:e=>n(e.target.value),className:"w-full resize-none rounded-xl border border-zinc-800 bg-black/60 px-3 py-2 text-sm text-white outline-none focus:border-amber-500/80 font-semibold leading-5 "+r,placeholder:"e.g.\n3x Amuse\nS1 feijoa"})}var c=n(1459);function d(e){let t=parseInt(e.replace(/[^\d]/g,""),10);return Number.isFinite(t)?t:9999}function o(e){return!!e&&Object.values(e).some(e=>(e||"").trim().length>0)}function x(e){return Object.entries(e||{}).map(e=>{let[t,n]=e;return{seat:Number(t),text:(n||"").trim()}}).filter(e=>e.text.length>0).sort((e,t)=>e.seat-t.seat)}function u(e){return(e||"").trim().toLowerCase()}function b(e){var t;let n=(null!==(t=null==e?void 0:e.courseLines)&&void 0!==t?t:[]).filter(e=>"FIRED"===e.status&&"number"==typeof e.firedAt).map(e=>e.firedAt);return 0===n.length?null:Math.min(...n)}function h(e,t){var n;let l={...e.seatDish||{}},s=e.seatSubs||{};for(let e=1;e<=t;e++){let t=(s[e]||"").trim();t&&(l[e]=t)}let r=[];for(let e=1;e<=t;e++){let t=(l[e]||"").trim();t&&r.push({seat:e,dish:t,key:u(t)})}if(0===r.length)return{baseDish:e.name,baseCount:t,exceptions:[]};let i=new Map;for(let e of r)i.set(e.key,(i.get(e.key)||0)+1);let a=r[0].key,c=i.get(a)||1;for(let[e,t]of i.entries())t>c&&(a=e,c=t);return{baseDish:(null===(n=r.find(e=>e.key===a))||void 0===n?void 0:n.dish)||r[0].dish,baseCount:c,exceptions:r.filter(e=>e.key!==a).map(e=>{let{seat:t,dish:n}=e;return{seat:t,dish:n}})}}function m(e){var t,n,r,d,o,u,h;let{table:m,markDone:f,now:g,pauseNeedsAttention:v=!1,onAcknowledgePause:N,mode:j="KDS",editMode:k,onToggleEdit:z,onEditCourseText:E,onMoveCourse:y,onDeleteCourse:w,onAddCourse:D,guestSubs:S,guestSeatMap:I,labelMode:R}=e,{t:O}=(0,c.Q)(),L=m.setup,C=null!=g?g:Date.now(),F="KDS"===j&&!!f,M=s.useRef(null),A=s.useRef(null),P=s.useRef({}),T=x(L.allergiesBySeat),U=T.length>0,G=!!L.paused,W=(null!==(d=null==L?void 0:L.courseLines)&&void 0!==d?d:[]).reduce((e,t)=>{var n;return e+(null!==(n=t.refireCount)&&void 0!==n?n:0)},0),_=b(L),K=_?Math.max(0,Math.floor((C-_)/6e4)):null,X=(null!==(o=null==L?void 0:L.courseLines)&&void 0!==o?o:[]).filter(e=>"FIRED"===e.status).length,B=(null!==(u=null==L?void 0:L.courseLines)&&void 0!==u?u:[]).filter(e=>"DONE"===e.status).length,V=(null!==(h=null==L?void 0:L.courseLines)&&void 0!==h?h:[]).length,H=function(e){var t;let n=null!==(t=null==e?void 0:e.courseLines)&&void 0!==t?t:[];if(0===n.length)return null;let l=[...n].reverse().find(e=>"FIRED"===e.status);if(l&&"number"==typeof l.idx)return l.idx;let s=n.find(e=>"PENDING"===e.status);return s&&"number"==typeof s.idx?s.idx:null}(L),Q=L.courseLines,Y=Q.filter(e=>"FIRED"===e.status),J=Y[0]||null,q=Q.find(e=>"PENDING"===e.status)||null,Z=function(e){if(!e||0===e.length)return null;let t=[...e].reverse().find(e=>"FIRED"===e.status);if(t&&"number"==typeof t.idx)return t.idx;let n=e.find(e=>"PENDING"===e.status);return n&&"number"==typeof n.idx?n.idx:null}(Q),$=Y.length,ee=Y[Y.length-1]||null,et=(null==ee?void 0:ee.firedAt)?Math.max(0,Math.floor((C-ee.firedAt)/6e4)):null,en=!!k&&!!E&&!!y&&!!w&&!!D,el=R||"approval";return s.useEffect(()=>{let e=setTimeout(()=>{var e;null===(e=A.current)||void 0===e||e.scrollIntoView({behavior:"smooth",block:"start"})},50);return()=>clearTimeout(e)},[null==L?void 0:L.courseLines]),(0,l.jsxs)("div",{className:"w-[360px] h-[calc(100vh-220px)] bg-white text-black rounded-sm shadow-2xl border border-zinc-300 overflow-hidden font-mono flex flex-col",children:[(0,l.jsx)("div",{className:"h-2 bg-zinc-200",style:{clipPath:"polygon(0% 100%, 4% 0%, 8% 100%, 12% 0%, 16% 100%, 20% 0%, 24% 100%, 28% 0%, 32% 100%, 36% 0%, 40% 100%, 44% 0%, 48% 100%, 52% 0%, 56% 100%, 60% 0%, 64% 100%, 68% 0%, 72% 100%, 76% 0%, 80% 100%, 84% 0%, 88% 100%, 92% 0%, 96% 100%, 100% 0%)"}}),(0,l.jsx)("div",{className:"p-4 border-b border-zinc-300 sticky top-0 bg-white z-20",children:(0,l.jsxs)("div",{className:"flex items-start justify-between gap-3",children:[(0,l.jsxs)("div",{className:"min-w-0",children:[(0,l.jsxs)("div",{className:"flex items-center gap-2",children:[(0,l.jsx)("div",{className:"text-3xl font-black tracking-tight",children:m.name}),m.tableLanguage?(0,l.jsx)("div",{className:"ml-2 px-2 py-1 rounded-lg border border-zinc-800 bg-black/40 text-[10px] font-black text-zinc-200",children:m.tableLanguage}):null]}),(0,l.jsxs)("div",{className:"text-xs mt-1 text-zinc-700",children:[m.pax," PAX • ",m.reservationName||"—"," • ",m.language||"—"]}),null!==Z||q?(0,l.jsxs)("div",{className:"mt-2 text-[11px] text-zinc-800",children:[(0,l.jsx)("span",{className:"font-black",children:"ON:"})," ",null!==Z?"#".concat(Z):"—",q?(0,l.jsxs)("span",{className:"text-zinc-600",children:[" • Next: #",q.idx]}):null]}):null,$>0?(0,l.jsxs)("div",{className:"mt-1 text-[11px] text-zinc-800",children:[(0,l.jsx)("span",{className:"font-black",children:"FIRED:"})," ",$," active",null!==et?(0,l.jsxs)("span",{className:"text-zinc-600",children:[" • Last: ",et,"m"]}):null,W>0?(0,l.jsxs)("span",{className:"text-zinc-600",children:[" • Refire: ",W]}):null]}):null,(0,l.jsxs)("div",{className:"text-[10px] mt-1 text-zinc-700 font-black tracking-widest",children:[null!==H?"".concat(O("ON COURSE","ON COURSE")," #").concat(H):"".concat(O("ON COURSE","ON COURSE")," —"),null!==K?" • ".concat(O("FIRED","FIRED")," ").concat(K,"m"):" • ".concat(O("FIRED","FIRED")," —")," • ".concat(O("FIRED","FIRED")," ").concat(X," • ").concat(O("DONE","DONE")," ").concat(B,"/").concat(V)]}),(null===(t=L.chefNote)||void 0===t?void 0:t.trim())?(0,l.jsxs)("div",{className:"mt-2 border border-zinc-300 bg-zinc-50 p-2",children:[(0,l.jsx)("div",{className:"text-[10px] font-black tracking-widest text-zinc-700 mb-1",children:"CHEF NOTE"}),(0,l.jsx)("div",{className:"text-[11px] text-zinc-800",children:L.chefNote})]}):null]}),(0,l.jsxs)("div",{className:"flex flex-col items-end gap-2 shrink-0",children:["KDS"===j?(0,l.jsx)("button",{onClick:()=>{var e;return null===(e=A.current)||void 0===e?void 0:e.scrollIntoView({behavior:"smooth",block:"start"})},className:"px-3 py-2 rounded-xl border border-zinc-300 bg-white text-xs font-black text-zinc-900 hover:bg-zinc-100",children:"JUMP NOW"}):null,z?(0,l.jsx)("button",{onClick:z,className:"px-3 py-2 rounded-xl border border-zinc-300 bg-white text-xs font-black text-zinc-900 hover:bg-zinc-100",children:k?"DONE":"EDIT"}):null,(0,l.jsxs)("span",{className:"text-[10px] font-black px-2 py-1 border border-zinc-400 bg-zinc-50 text-zinc-800",children:[O("MENU","MENU")," ",(null===(n=(0,i.F)(L.menuId))||void 0===n?void 0:n.label)||O("Menu","Menu")]}),L.pairing?(0,l.jsx)("div",{className:"ml-2 px-2 py-1 rounded-lg border border-indigo-700 bg-indigo-50 text-[10px] font-black text-indigo-700",children:O("SLOW PACE","SLOW PACE")}):null,U&&(0,l.jsx)("span",{className:"text-[10px] font-black px-2 py-1 border border-red-600 bg-red-50 text-red-700",children:O("ALLERGY","ALLERGY")}),G?F&&N?(0,l.jsx)("button",{type:"button",onClick:N,className:["ml-2 px-2 py-1 rounded-lg border border-red-700 bg-red-50 text-[10px] font-black text-red-700",v?"animate-pulse":""].join(" "),title:v?"Tap to acknowledge pause":"Pause acknowledged",children:O("PAUSED","PAUSED")}):(0,l.jsx)("div",{className:"ml-2 px-2 py-1 rounded-lg border border-red-700 bg-red-50 text-[10px] font-black text-red-700",children:O("PAUSED","PAUSED")}):null]})]})}),(0,l.jsxs)("div",{className:"p-3 overflow-y-auto",children:[T.length>0&&(0,l.jsxs)("div",{className:"mb-3 border border-zinc-300 bg-zinc-50 p-2",children:[(0,l.jsx)("div",{className:"text-[10px] font-black tracking-widest text-zinc-700 mb-1",children:O("SEAT NOTES","SEAT NOTES")}),(0,l.jsx)("div",{className:"text-[11px] text-zinc-800 space-y-1",children:T.map(e=>(0,l.jsxs)("div",{children:[(0,l.jsxs)("span",{className:"font-black",children:[O("Seat","Seat")," ",e.seat,":"]})," ",e.text]},e.seat))})]}),J&&!en?(0,l.jsxs)("div",{className:"mt-3 rounded-xl border border-zinc-300 bg-white p-3",children:[(0,l.jsx)("div",{className:"text-[10px] font-black tracking-widest text-zinc-600",children:O("NOW","NOW")}),(0,l.jsx)(p,{course:J,onDone:F?()=>null==f?void 0:f(m.id,J.id):void 0,doneLock:P,now:C,nextPendingId:null,pax:m.pax,extras:(null===(r=L.extrasByCourseId)||void 0===r?void 0:r[J.id])||[],mode:j,guestSubs:S,guestSeatMap:I,labelMode:el})]}):en?null:(0,l.jsxs)("div",{className:"mt-3 rounded-xl border border-zinc-300 bg-white p-3",children:[(0,l.jsx)("div",{className:"text-[10px] font-black tracking-widest text-zinc-600",children:O("NOW","NOW")}),(0,l.jsx)("div",{className:"text-sm text-zinc-500",children:O("Nothing fired.","Nothing fired.")})]}),(0,l.jsxs)("div",{className:"mt-3 rounded-xl border border-zinc-200 bg-zinc-50 overflow-hidden",children:[(0,l.jsxs)("div",{className:"px-3 py-2 border-b border-zinc-200 flex items-center justify-between",children:[(0,l.jsx)("div",{className:"text-[10px] font-black tracking-widest text-zinc-600",children:O("FULL MENU","FULL MENU")}),(0,l.jsxs)("div",{className:"text-[10px] font-black text-zinc-500",children:[Q.length," ",O("courses","courses")]})]}),(0,l.jsx)("div",{ref:M,className:"max-h-[520px] overflow-y-auto",children:(0,l.jsx)("div",{className:"p-3 space-y-2",children:Q.map(e=>{var t;return(0,l.jsx)("div",{ref:"FIRED"===e.status?A:void 0,className:["rounded-lg border p-2","FIRED"===e.status?"border-amber-400 bg-amber-50":"border-zinc-200 bg-white"].join(" "),children:en?(0,l.jsxs)("div",{children:[(0,l.jsx)(a,{value:e.displayText||e.name||"",onChange:t=>null==E?void 0:E(e.id,t)}),(0,l.jsxs)("div",{className:"mt-2 flex gap-2",children:[(0,l.jsx)("button",{onClick:()=>null==y?void 0:y(e.id,-1),className:"px-3 py-2 rounded-xl text-xs font-black border border-zinc-300 bg-white text-zinc-900 hover:bg-zinc-100",children:"↑"}),(0,l.jsx)("button",{onClick:()=>null==y?void 0:y(e.id,1),className:"px-3 py-2 rounded-xl text-xs font-black border border-zinc-300 bg-white text-zinc-900 hover:bg-zinc-100",children:"↓"}),(0,l.jsx)("button",{onClick:()=>null==w?void 0:w(e.id),className:"px-3 py-2 rounded-xl text-xs font-black border border-red-400 bg-red-50 text-red-800 hover:bg-red-100",children:"DELETE"}),(0,l.jsx)("button",{onClick:()=>null==D?void 0:D(e.id),className:"px-3 py-2 rounded-xl text-xs font-black border border-amber-400 bg-amber-50 text-amber-900 hover:bg-amber-100",children:"+ ADD"})]})]}):(0,l.jsx)(p,{course:e,onDone:F?()=>null==f?void 0:f(m.id,e.id):void 0,doneLock:P,now:C,nextPendingId:null,pax:m.pax,extras:(null===(t=L.extrasByCourseId)||void 0===t?void 0:t[e.id])||[],mode:j,guestSubs:S,guestSeatMap:I,labelMode:el})},e.id)})})})]})]}),(0,l.jsx)("div",{className:"h-2 bg-white border-t border-zinc-200",style:{clipPath:"polygon(0% 0%, 4% 100%, 8% 0%, 12% 100%, 16% 0%, 20% 100%, 24% 0%, 28% 100%, 32% 0%, 36% 100%, 40% 0%, 44% 100%, 48% 0%, 52% 100%, 56% 0%, 60% 100%, 64% 0%, 68% 100%, 72% 0%, 76% 100%, 80% 0%, 84% 100%, 88% 0%, 92% 100%, 96% 0%, 100% 100%)"}})]})}function p(e){var t;let{course:n,onDone:i,doneLock:a,now:d,nextPendingId:o,pax:x,extras:b,mode:m="KDS",guestSubs:p,guestSeatMap:f,labelMode:g="approval"}=e,{t:v}=(0,c.Q)(),N="FIRED"===n.status,j="DONE"===n.status,k="PENDING"===n.status&&o===n.id,z=N&&n.firedAt?Math.max(0,Math.floor((d-n.firedAt)/6e4)):null,E=null!==(t=n.refireCount)&&void 0!==t?t:0,{baseDish:y,baseCount:w,exceptions:D}=h(n,x),S=(p||[]).filter(e=>e.courseId===n.id),I=Array.from(new Set(S.map(e=>e.guest))).length,R=s.useMemo(()=>{let e=new Set;if(!S.length)return e;let t=(0,r.NK)(x),n=e=>{let n=null==f?void 0:f[e];if(n&&n>=1)return n;let l=t.indexOf(e);return l>=0?l+1:null};for(let t of S){let l=n(t.guest);l&&e.add(l)}return e},[S,f,x]),O=function(e,t,n,l){var s;let i={...e.seatDish||{}},a=[];for(let e=1;e<=t;e++){let t=(i[e]||"").trim();t&&a.push({seat:e,dish:t,key:u(t)})}if(0===a.length)return{baseDish:e.name,baseCount:t,guestLines:[]};let c=new Map;for(let e of a)c.set(e.key,(c.get(e.key)||0)+1);let d=a[0].key,o=c.get(d)||1;for(let[e,t]of c.entries())t>o&&(d=e,o=t);let x=(null===(s=a.find(e=>e.key===d))||void 0===s?void 0:s.dish)||a[0].dish,b={},h=(0,r.NK)(t);for(let e=1;e<=t;e++){let t=h[e-1];b[e]=t?"Guest ".concat(t):"Seat ".concat(e)}n&&Object.entries(n).forEach(e=>{let[n,l]=e;l&&l>=1&&l<=t&&(b[l]="Guest ".concat(n))});let m=a.filter(e=>e.key!==d&&!(null==l?void 0:l.has(e.seat))),p=Math.max(0,t-m.length),f=new Map;for(let e of m){let t=b[e.seat],n=f.get(e.dish)||[];n.push(t),f.set(e.dish,n)}return{baseDish:x,baseCount:p,guestLines:Array.from(f.entries()).map(e=>{let[t,n]=e;return{label:n.join(" & "),dish:t}})}}(n,x,f,R),L=Object.entries(n.seatSubs||{}).map(e=>{let[t,n]=e;return{seat:Number(t),text:(n||"").trim()}}).filter(e=>e.text.length>0).sort((e,t)=>e.seat-t.seat),C=new Set(D.map(e=>e.seat)),F=L.filter(e=>!C.has(e.seat)),M="draft"===g,A="draft"!==g,P=s.useCallback(()=>{if(!i)return;let e=n.id,t=a.current[e]||0,l=Date.now();l-t<900||(a.current[e]=l,i())},[n.id,a,i]),T="PREVIEW"===m,U=(n.displayText||"").split("\n"),G=(U[0]||"").trim(),W=U.slice(1).map(e=>e.trim()).filter(e=>e.length>0);return(0,l.jsx)("div",{className:["py-1 px-2 -mx-2 rounded",N?"bg-orange-50 border border-orange-200":"",k?"border border-zinc-400 bg-zinc-50":"",j?"opacity-40":"PENDING"===n.status?"opacity-85":""].join(" "),children:(0,l.jsxs)("div",{className:"flex items-start justify-between gap-3",children:[(0,l.jsxs)("div",{className:"min-w-0",children:[(0,l.jsxs)("div",{className:"flex items-baseline gap-2 flex-wrap",children:[(0,l.jsxs)("div",{className:"text-xs font-black w-8 text-right",children:[n.idx,"."]}),(0,l.jsx)("div",{className:["text-sm font-bold truncate",j?"line-through text-zinc-500":""].join(" "),children:G||"".concat(Math.max(0,(M?O.baseCount:w)-(M?I:0)),"x ").concat(M&&O.baseDish||y)}),N&&(0,l.jsx)("span",{className:"text-[10px] font-black px-2 py-0.5 border border-orange-600 bg-white text-orange-800",children:v("FIRED","FIRED")}),k&&(0,l.jsx)("span",{className:"text-[10px] font-black px-2 py-0.5 border border-zinc-500 bg-white text-zinc-700",children:v("NEXT","NEXT")}),j&&(0,l.jsx)("span",{className:"text-[10px] font-black px-2 py-0.5 border border-green-700 bg-white text-green-800",children:v("DONE","DONE")}),N&&null!==z&&(0,l.jsxs)("span",{className:"text-[10px] font-black px-2 py-0.5 border border-zinc-400 bg-white text-zinc-700",children:[z,"m"]}),N&&E>0&&(0,l.jsxs)("span",{className:"text-[10px] font-black px-2 py-0.5 border border-orange-600 bg-white text-orange-800",children:["REFIRE x",E]})]}),W.length>0?(0,l.jsx)("div",{className:"mt-1 space-y-1",children:W.map((e,t)=>(0,l.jsx)("div",{className:"text-xs text-zinc-300 font-semibold",children:e},"".concat(n.id,"_dl_").concat(t)))}):null,M&&O.guestLines.length>0?(0,l.jsx)("div",{className:"mt-1 text-[11px] text-zinc-700 space-y-0.5",children:O.guestLines.map((e,t)=>(0,l.jsxs)("div",{className:"font-black",children:[e.label," — ",e.dish]},"".concat(n.id,"_gmenu_").concat(t)))}):null,D.length>0&&A?(0,l.jsx)("div",{className:["mt-1 text-[11px] space-y-0.5",T?"text-amber-800":"text-zinc-700"].join(" "),children:D.map(e=>(0,l.jsxs)("div",{className:T?"font-black":"",children:[(0,l.jsxs)("span",{className:"font-black",children:[v("Seat","Seat")," ",e.seat," →"]})," ",e.dish]},e.seat))}):null,M&&S.length>0?(0,l.jsx)("div",{className:"mt-1 text-[11px] text-zinc-700 space-y-0.5",children:S.map(e=>(0,l.jsxs)("div",{className:"font-black",children:[v("Guest","Guest")," ",e.guest," — ",e.text]},e.id))}):A&&F.length>0?(0,l.jsx)("div",{className:["mt-1 text-[11px] space-y-0.5",T?"text-amber-800":"text-zinc-700"].join(" "),children:F.map(e=>(0,l.jsxs)("div",{className:[j?"line-through text-zinc-500":"",T?"font-black":""].join(" "),children:[(0,l.jsxs)("span",{className:"font-black",children:[v("Seat","Seat")," ",e.seat," →"]})," ",v("Substitute","Substitute"),": ",e.text]},e.seat))}):null,b.length>0&&(0,l.jsx)("div",{className:"mt-1 text-[11px] text-zinc-800 space-y-0.5",children:b.map((e,t)=>(0,l.jsxs)("div",{children:[(0,l.jsxs)("span",{className:"font-black",children:[v("EXTRA","EXTRA"),":"]})," ",e]},"".concat(e,"_").concat(t)))})]}),(0,l.jsx)("div",{className:"shrink-0",children:"KDS"===m?(0,l.jsx)("button",{disabled:!N,onClick:P,className:["px-4 py-3 rounded-2xl border text-sm font-black transition",N?"border-zinc-300 bg-white text-zinc-900 hover:bg-zinc-100":"border-zinc-300 bg-zinc-100 text-zinc-400 cursor-not-allowed"].join(" "),children:v("DONE","DONE")}):null})]})})}}}]);