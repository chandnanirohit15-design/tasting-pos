(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[535],{2105:function(e,t,n){Promise.resolve().then(n.bind(n,1179))},514:function(e,t,n){"use strict";n.d(t,{b:function(){return i}});var a=n(7437),s=n(2265);function l(e,t){let n={};for(let[r,i]of Object.entries(e||{})){var a,s,l;let e=Number(r);e&&i&&(n[e]={id:e,name:i.name,x:i.x,y:i.y,w:null!==(a=i.w)&&void 0!==a?a:92,h:null!==(s=i.h)&&void 0!==s?s:92,obj:null!==(l=i.obj)&&void 0!==l?l:i.shape,..."legacy"===t?{main:i.main}:{pageId:i.pageId}})}return n}var r=n(1459);function i(e){var t,n,i;let{tables:d,mode:o="service",storageKey:c,selectedReservationId:x,onDropReservationOnTable:b,onClickTable:u,activePageId:m,onChangePage:p}=e,{t:v}=(0,r.Q)(),h=c||"tastingpos_room_active_map_page",[g,N]=s.useState(null),[f,j]=s.useState(null!=m?m:null);s.useEffect(()=>{N(function(){let e=window.localStorage.getItem("tastingpos_layout_v6"),t=window.localStorage.getItem("tastingpos_layout_v5"),n=e=>{if(!e)return null;try{return JSON.parse(e)}catch(e){return null}},a=n(e);if(a&&Array.isArray(a.pages)){let e=a.pageRects||{};for(let t of a.pages)e[t.id]||(e[t.id]={x:0,y:0,w:900,h:756});return{kind:"pages",pages:a.pages,rectByPage:e,zones:a.zones||[],walls:a.walls||[],tableById:l(a.tables||{},"pages")}}let s=n(t);if(s&&s.mains){let e=s.mainLabels||{RESTAURANTE:"RESTAURANTE",TERRAZA:"TERRAZA",VIP:"ZONA VIP"},t=["RESTAURANTE","TERRAZA","VIP"].map(t=>({id:t,label:e[t]||t})),n={};for(let e of["RESTAURANTE","TERRAZA","VIP"])n[e]=s.mains[e]||{x:0,y:0,w:900,h:756};return{kind:"legacy",pages:t,rectByPage:n,zones:s.zones||[],walls:s.walls||[],tableById:l(s.tables||{},"legacy")}}return null}())},[]),s.useEffect(()=>{void 0!==m&&j(m)},[m]);let E=(null==g?void 0:g.pages)||[{id:"RESTAURANTE",label:v("RESTAURANTE","RESTAURANTE")}];s.useEffect(()=>{!f&&E.length&&j(E[0].id)},[f,E]),s.useEffect(()=>{if(g)try{let e=localStorage.getItem(h);e&&E.some(t=>t.id===e)&&j(e)}catch(e){}},[g,E,h]);let z=f||(null!==(i=null===(t=E[0])||void 0===t?void 0:t.id)&&void 0!==i?i:v("RESTAURANTE","RESTAURANTE")),k=(null==g?void 0:null===(n=g.rectByPage)||void 0===n?void 0:n[z])||{x:0,y:0,w:900,h:756},S=((null==g?void 0:g.zones)||[]).filter(e=>{var t;return(null!==(t=e.pageId)&&void 0!==t?t:e.main)===z}),y=((null==g?void 0:g.walls)||[]).filter(e=>{var t;return(null!==(t=e.pageId)&&void 0!==t?t:e.main)===z}),T=(null==g?void 0:g.tableById)||{},C=d.filter(e=>{var t;let n=T[e.id];return((null!==(t=null==n?void 0:n.pageId)&&void 0!==t?t:null==n?void 0:n.main)||e.pageId||e.main)===z}).map(e=>{var t,n,a,s,l,r,i,d,o,c;let x=T[e.id],b=null!==(n=null!==(t=null==x?void 0:x.w)&&void 0!==t?t:e.w)&&void 0!==n?n:92,u=null!==(s=null!==(a=null==x?void 0:x.h)&&void 0!==a?a:e.h)&&void 0!==s?s:92,m=null!==(r=null!==(l=null==x?void 0:x.x)&&void 0!==l?l:e.x)&&void 0!==r?r:k.x+80,p=null!==(d=null!==(i=null==x?void 0:x.y)&&void 0!==i?i:e.y)&&void 0!==d?d:k.y+80,v=null!==(c=null!==(o=null==x?void 0:x.obj)&&void 0!==o?o:e.obj)&&void 0!==c?c:"TABLE_SQUARE";return{table:e,lt:{x:m,y:p,w:b,h:u,obj:v}}}),w=e=>{j(e),null==p||p(e);try{localStorage.setItem(h,e)}catch(e){}},R=e=>{"seating"===o&&(e.preventDefault(),e.dataTransfer.dropEffect="move")},A=(e,t)=>{if("seating"!==o)return;e.preventDefault();let n=e.dataTransfer.getData("text/plain");n&&(null==b||b(n,t))};return(0,a.jsxs)("div",{className:"h-full w-full",children:[(0,a.jsx)("div",{className:"flex items-center gap-2 mb-3",children:E.map(e=>(0,a.jsx)("button",{onClick:()=>w(e.id),className:["px-4 py-2 rounded-xl text-xs font-black border transition",z===e.id?"bg-amber-500 text-black border-amber-400":"bg-zinc-950/40 text-zinc-200 border-zinc-800 hover:bg-zinc-900/40"].join(" "),children:e.label},e.id))}),(0,a.jsxs)("div",{className:"relative rounded-2xl border border-zinc-800 bg-black/30 overflow-hidden",children:[(0,a.jsx)("div",{className:"absolute inset-0 pointer-events-none",style:{backgroundImage:"linear-gradient(to right, rgba(255,255,255,0.10) 1px, transparent 1px), linear-gradient(to bottom, rgba(255,255,255,0.10) 1px, transparent 1px)",backgroundSize:"20px 20px",opacity:.06}}),(0,a.jsx)("div",{className:"absolute inset-0 pointer-events-none shadow-[inset_0_0_120px_rgba(0,0,0,0.85)]"}),(0,a.jsx)("div",{className:"relative p-4",children:(0,a.jsxs)("div",{className:"relative rounded-2xl border border-zinc-800/80 overflow-hidden bg-gradient-to-b from-zinc-950/40 to-black/40",style:{width:k.w,height:k.h},children:[S.map(e=>(0,a.jsx)("div",{className:"absolute rounded-2xl border border-zinc-800/80 bg-zinc-900/10",style:{left:e.x-k.x,top:e.y-k.y,width:e.w,height:e.h},children:e.label?(0,a.jsx)("div",{className:"absolute top-2 left-2 text-[10px] font-black px-2 py-1 rounded-lg border border-zinc-800 bg-black/40 text-zinc-200",children:e.label}):null},e.id)),y.map(e=>(0,a.jsx)("div",{className:"absolute rounded border border-zinc-800/80 bg-zinc-500/40",style:{left:e.x-k.x,top:e.y-k.y,width:e.w,height:e.h}},e.id)),C.map(e=>{let{table:t,lt:n}=e,s="ASSIGNED"===t.reservationStatus,l="SEATED"===t.reservationStatus||"SEATED"===t.status,r="TABLE_ROUND"===n.obj;return(0,a.jsxs)("div",{onClick:()=>null==u?void 0:u(t.id),onDragOver:R,onDrop:e=>A(e,t.id),className:["absolute select-none border backdrop-blur-md overflow-hidden",r?"rounded-full":"rounded-2xl",x&&"seating"===o?"cursor-pointer hover:scale-[1.01]":"cursor-default",l?"border-emerald-500/60 bg-black/40":s?"border-amber-500/60 bg-black/35":"border-zinc-800/90 bg-black/25"].join(" "),style:{left:n.x-k.x,top:n.y-k.y,width:n.w,height:n.h},title:t.name,children:[(0,a.jsx)("div",{className:"absolute inset-0 pointer-events-none [background:radial-gradient(circle_at_30%_20%,rgba(255,255,255,0.10),transparent_55%)]"}),t.tableLanguage?(0,a.jsx)("div",{className:"absolute top-1 right-1 px-2 py-1 rounded-lg border border-zinc-800 bg-black/50 text-[10px] font-black text-zinc-200",children:t.tableLanguage}):null,(0,a.jsxs)("div",{className:"absolute inset-0 flex flex-col items-center justify-center",children:[(0,a.jsx)("div",{className:"text-[14px] font-black text-white",children:t.name}),l&&t.reservationName?(0,a.jsx)("div",{className:"mt-1 text-[11px] font-semibold text-zinc-300 max-w-[90%] truncate",children:t.reservationName}):null,s&&!l&&t.reservationName?(0,a.jsxs)("div",{className:"mt-1 text-[11px] font-semibold text-amber-200 max-w-[90%] truncate",children:[v("Assigned","Assigned"),": ",t.reservationName]}):null,l||s||"seating"!==o?null:(0,a.jsx)("div",{className:"mt-1 text-[10px] text-zinc-500",children:v("Drop reservation","Drop reservation")})]})]},t.id)})]})}),(0,a.jsx)("div",{className:"px-4 pb-4 text-xs text-zinc-500",children:"seating"===o?v("Seating mode: drag reservation onto table","Seating mode: drag reservation onto table"):v("Service mode: map is read-only","Service mode: map is read-only")})]})]})}},1179:function(e,t,n){"use strict";n.r(t),n.d(t,{default:function(){return c}});var a=n(7437),s=n(2265),l=n(4310),r=n(514),i=n(5376),d=n(7188),o=n(1459);function c(){let{t:e}=(0,o.Q)(),{reservations:t,tables:n,assignReservationToTable:c,clearReservationFromTable:m,seatAssignedTable:p,updateReservation:v,updateReservationNote:h,addReservation:g,deleteReservation:N,setDraftMenu:f,setDraftGuestMenu:j,createDraftForReservation:E,markDraftPrepared:z,clearDraft:k,draftInsertCourse:S,draftDeleteCourse:y,draftMoveCourse:T,draftAddExtraDish:C,draftRemoveExtraDish:w,dishPresets:R,draftAddGuestSub:A,draftRemoveGuestSub:D,getEffectiveDraftSetupForTable:I}=(0,l.mr)(),[O,L]=s.useState(null),[P,U]=s.useState(null),[_,M]=s.useState(""),[V,G]=s.useState("NOT_SEATED"),[F,B]=s.useState(null),[W,H]=s.useState(()=>new Date().toISOString().slice(0,10)),[K,Z]=s.useState("DINNER"),[Q,X]=s.useState("PLAN"),[J,q]=s.useState(null),Y=s.useMemo(()=>t.find(e=>e.id===O)||null,[t,O]),$=s.useMemo(()=>t.find(e=>e.id===J)||null,[t,J]),ee=s.useMemo(()=>t.find(e=>e.id===F)||null,[t,F]),et=s.useMemo(()=>new Map(n.map(e=>[e.id,e])),[n]),en=t.filter(e=>(!e.date||e.date===W)&&(!e.service||e.service===K)).filter(e=>{var t,n,a,s;let l=_.trim().toLowerCase();return!l||(null===(t=e.name)||void 0===t?void 0:t.toLowerCase().includes(l))||String(null!==(s=e.pax)&&void 0!==s?s:"").includes(l)||(null===(a=e.time)||void 0===a?void 0:null===(n=a.toLowerCase)||void 0===n?void 0:n.call(a).includes(l))}).filter(e=>{let t=!!e.tableId;return"ALL"===V||("SEATED"===V?t:!t)}),ea=!!ee,es=s.useMemo(()=>{if(!ee)return null;let e={};return(0,l.NK)(ee.pax).forEach((t,n)=>{e[t]=n+1}),{...e,...ee.draftGuestSeatMap||{}}},[ee]),el=s.useMemo(()=>{if(!(null==ee?void 0:ee.draftSetup))return null;let e={id:-1,name:ee.tablePref||"RES",pax:ee.pax,status:"SEATED",x:0,y:0,reservationName:ee.name,reservationPax:ee.pax,reservationTime:ee.time,language:ee.language,setup:ee.draftSetup},t={...ee,tableId:-1,draftGuestSeatMap:es||{}},n=I(t,t.pax||0);return{...e,setup:null!=n?n:e.setup}},[ee,es,I]),er=s.useCallback((e,a)=>{let s=t.find(t=>t.id===e);if(!s)return;let l=n.find(e=>e.id===a);if(l){if(("ASSIGNED"===l.reservationStatus||"SEATED"===l.reservationStatus)&&!window.confirm("Table ".concat(l.name," is already reserved. Replace?")))return;c(s,a),v(e,{tableId:a}),l.reservationId&&v(l.reservationId,{tableId:void 0}),"SERVICE"===Q&&p(a),L(t=>t===e?null:t)}},[c,t,n,v,p,Q]),ei=s.useCallback(e=>{let n=t.find(t=>t.id===e);(null==n?void 0:n.tableId)&&(m(n.tableId),v(e,{tableId:void 0}))},[m,t,v]),ed=(e,t)=>{e.dataTransfer.setData("text/plain",t),e.dataTransfer.effectAllowed="move"};return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)("div",{className:["h-full w-full bg-[#0b0b0d] grid",ea?"md:grid-cols-[360px_1fr_380px]":"md:grid-cols-[380px_1fr]"].join(" "),children:[(0,a.jsxs)("aside",{className:"border-r border-zinc-800 bg-zinc-950 p-4 overflow-y-auto",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between mb-3",children:[(0,a.jsx)("h2",{className:"text-sm font-bold tracking-wide text-zinc-200",children:e("Reservations","Reservations")}),(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)("span",{className:"text-xs text-zinc-500",children:t.length}),(0,a.jsx)("button",{onClick:()=>{var t;let n="r_".concat(Math.random().toString(36).slice(2),"_").concat(Date.now().toString(16));g({id:n,name:e("New reservation","New reservation"),pax:2,language:"EN",date:W,service:K,status:"BOOKED",note:"",reservationNote:"",draftMenuId:(null===(t=(0,d.ri)().menus[0])||void 0===t?void 0:t.id)||"m_a",tags:[]}),q(n)},className:"px-4 py-2 rounded-xl text-xs font-black border border-amber-400 bg-amber-500 text-black hover:bg-amber-400",children:e("+ NEW","+ NEW")})]})]}),(0,a.jsx)("div",{className:"text-xs text-zinc-500 mb-3",children:e("Tap a reservation then tap a table, or drag it onto a table.","Tap a reservation then tap a table, or drag it onto a table.")}),(0,a.jsxs)("div",{className:"flex flex-wrap items-center gap-2 mb-3",children:[(0,a.jsx)("input",{type:"date",value:W,onChange:e=>H(e.target.value),className:"rounded-xl bg-black/60 border border-zinc-800 text-white px-3 py-2 text-sm outline-none"}),(0,a.jsx)("button",{onClick:()=>Z("LUNCH"),className:["px-4 py-2 rounded-xl text-xs font-black border transition","LUNCH"===K?"bg-amber-500 text-black border-amber-400":"bg-zinc-950 text-zinc-200 border-zinc-800 hover:bg-zinc-900"].join(" "),children:e("LUNCH","LUNCH")}),(0,a.jsx)("button",{onClick:()=>Z("DINNER"),className:["px-4 py-2 rounded-xl text-xs font-black border transition","DINNER"===K?"bg-amber-500 text-black border-amber-400":"bg-zinc-950 text-zinc-200 border-zinc-800 hover:bg-zinc-900"].join(" "),children:e("DINNER","DINNER")}),(0,a.jsx)("button",{onClick:()=>X("PLAN"),className:["px-4 py-2 rounded-xl text-xs font-black border transition","PLAN"===Q?"bg-amber-500 text-black border-amber-400":"bg-zinc-950 text-zinc-200 border-zinc-800 hover:bg-zinc-900"].join(" "),children:e("PLAN VIEW","PLAN VIEW")}),(0,a.jsx)("button",{onClick:()=>X("SERVICE"),className:["px-4 py-2 rounded-xl text-xs font-black border transition","SERVICE"===Q?"bg-amber-500 text-black border-amber-400":"bg-zinc-950 text-zinc-200 border-zinc-800 hover:bg-zinc-900"].join(" "),children:e("SERVICE VIEW","SERVICE VIEW")})]}),(0,a.jsxs)("div",{className:"flex items-center gap-2 mb-3",children:[(0,a.jsx)("input",{value:_,onChange:e=>M(e.target.value),placeholder:e("Search name / pax / time…","Search name / pax / time…"),className:"flex-1 rounded-xl bg-black/60 border border-zinc-800 text-white px-3 py-2 text-sm outline-none focus:border-amber-500/80"}),(0,a.jsxs)("select",{value:V,onChange:e=>G(e.target.value),className:"rounded-xl bg-black/60 border border-zinc-800 text-white px-3 py-2 text-sm outline-none",children:[(0,a.jsx)("option",{value:"NOT_SEATED",children:e("Not seated","Not seated")}),(0,a.jsx)("option",{value:"SEATED",children:e("Seated","Seated")}),(0,a.jsx)("option",{value:"ALL",children:e("All","All")})]})]}),(0,a.jsxs)("div",{className:"space-y-2",children:[en.map(t=>{var n,s,l,r;let i=t.id===O;return(0,a.jsxs)("div",{draggable:!0,onDragStart:e=>ed(e,t.id),onClick:()=>L(i?null:t.id),className:["cursor-pointer select-none rounded-xl border p-3 transition",i?"border-amber-500/70 bg-amber-500/10":"border-zinc-800 bg-zinc-900/40 hover:bg-zinc-900/70"].join(" "),children:[(0,a.jsxs)("div",{className:"flex items-start justify-between",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("div",{className:"text-sm font-bold text-white",children:t.name}),(0,a.jsxs)("div",{className:"text-xs text-zinc-400 mt-0.5",children:[t.time," • ",t.pax," ",e("pax","pax")]}),t.tableId?(0,a.jsxs)("div",{className:"mt-1 text-xs font-black text-amber-300",children:[e("Assigned to","Assigned to")," ",(null===(n=et.get(t.tableId))||void 0===n?void 0:n.name)||"T".concat(t.tableId)]}):null]}),(0,a.jsx)("span",{className:"text-[10px] px-2 py-0.5 rounded border border-zinc-700 bg-zinc-900 text-zinc-200 font-bold",children:t.language})]}),(0,a.jsx)("div",{className:"mt-1 flex items-center gap-2",children:(0,a.jsxs)("span",{className:"text-[10px] px-2 py-0.5 rounded border border-zinc-700 bg-zinc-950 text-zinc-200 font-bold",children:[e("DRAFT","DRAFT")," ",t.draftStatus||"NONE"]})}),(0,a.jsxs)("div",{className:"mt-2 flex items-center justify-between",children:[(0,a.jsxs)("button",{onClick:e=>{e.stopPropagation(),U(P===t.id?null:t.id)},className:"text-[11px] font-black px-2 py-1 rounded-lg border border-zinc-800 bg-black/40 text-zinc-300 hover:bg-zinc-900/40",children:[e("Notes","Notes"),t.reservationNote?(0,a.jsx)("span",{className:"ml-2 text-[10px] font-black text-amber-300",children:e("NOTE","NOTE")}):null]}),(0,a.jsx)("button",{onClick:e=>{e.stopPropagation(),q(t.id)},className:"px-3 py-2 rounded-xl text-xs font-black border border-zinc-800 bg-black/35 text-zinc-200 hover:bg-zinc-900/40",children:e("EDIT","EDIT")})]}),(0,a.jsxs)("div",{className:"mt-2 flex flex-wrap gap-2",children:[(null!==(s=t.draftStatus)&&void 0!==s?s:"NONE")==="NONE"?(0,a.jsx)("button",{onClick:e=>{e.stopPropagation(),E(t.id),B(t.id)},className:"px-3 py-2 rounded-xl text-xs font-black border border-amber-500/60 bg-amber-500/10 text-amber-200 hover:bg-amber-500/20",children:e("CREATE DRAFT","CREATE DRAFT")}):null,(null!==(l=t.draftStatus)&&void 0!==l?l:"NONE")==="DRAFT"?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("button",{onClick:e=>{e.stopPropagation(),B(t.id)},className:"px-3 py-2 rounded-xl text-xs font-black border border-zinc-700 bg-black/40 text-zinc-200 hover:bg-zinc-900/40",children:e("EDIT DRAFT","EDIT DRAFT")}),(0,a.jsx)("button",{onClick:e=>{e.stopPropagation(),z(t.id)},className:"px-3 py-2 rounded-xl text-xs font-black border border-green-600/60 bg-green-900/20 text-green-200 hover:bg-green-900/30",children:e("MARK PREPPED","MARK PREPPED")}),(0,a.jsx)("button",{onClick:e=>{e.stopPropagation(),k(t.id),F===t.id&&B(null)},className:"px-3 py-2 rounded-xl text-xs font-black border border-red-700 bg-red-900/20 text-red-200 hover:bg-red-900/30",children:e("CLEAR","CLEAR")})]}):null,(null!==(r=t.draftStatus)&&void 0!==r?r:"NONE")==="PREPPED"?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("button",{onClick:e=>{e.stopPropagation(),B(t.id)},className:"px-3 py-2 rounded-xl text-xs font-black border border-zinc-700 bg-black/40 text-zinc-200 hover:bg-zinc-900/40",children:e("VIEW/EDIT","VIEW/EDIT")}),(0,a.jsx)("button",{onClick:e=>{e.stopPropagation(),v(t.id,{draftStatus:"DRAFT",draftUpdatedAt:Date.now()})},className:"px-3 py-2 rounded-xl text-xs font-black border border-zinc-700 bg-black/40 text-zinc-200 hover:bg-zinc-900/40",children:e("UNPREP","UNPREP")}),(0,a.jsx)("button",{onClick:e=>{e.stopPropagation(),k(t.id),F===t.id&&B(null)},className:"px-3 py-2 rounded-xl text-xs font-black border border-red-700 bg-red-900/20 text-red-200 hover:bg-red-900/30",children:e("CLEAR","CLEAR")})]}):null]}),P===t.id&&t.reservationNote?(0,a.jsx)("div",{className:"mt-2 text-xs text-zinc-300 rounded-xl border border-zinc-800 bg-black/40 p-2",children:t.reservationNote}):null,t.tableId?(0,a.jsxs)("div",{className:"mt-2 flex gap-2",children:[(0,a.jsx)("button",{onClick:e=>{e.stopPropagation(),ei(t.id)},className:"px-3 py-2 rounded-xl text-xs font-black border border-zinc-800 bg-black/35 text-zinc-200 hover:bg-zinc-900/40",children:e("UNSEAT","UNSEAT")}),(0,a.jsx)("button",{onClick:e=>{e.stopPropagation(),L(t.id)},className:"px-3 py-2 rounded-xl text-xs font-black border border-amber-400/50 bg-amber-500/10 text-amber-200 hover:bg-amber-500/15",children:e("MOVE","MOVE")})]}):null,(0,a.jsx)("div",{className:"text-[10px] text-zinc-600 mt-2",children:e("Drag to table • Tap to select","Drag to table • Tap to select")})]},t.id)}),0===en.length&&(0,a.jsx)("div",{className:"text-sm text-zinc-500 border border-dashed border-zinc-800 rounded-xl p-4",children:e("No reservations match this filter.","No reservations match this filter.")})]}),(0,a.jsxs)("div",{className:"mt-4 border-t border-zinc-800 pt-3",children:[(0,a.jsx)("div",{className:"text-xs text-zinc-500",children:e("Selected","Selected")}),(0,a.jsx)("div",{className:"text-sm text-white font-bold",children:Y?"".concat(Y.name," (").concat(Y.pax,")"):e("None","None")})]})]}),(0,a.jsx)("main",{className:"overflow-hidden bg-[#0f0f12]",children:ea?(0,a.jsxs)("div",{className:"hidden md:block h-full w-full p-6 overflow-y-auto",children:[(0,a.jsxs)("div",{className:"mb-4 flex items-center justify-between gap-2",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("div",{className:"text-sm font-black text-white",children:e("Draft Ticket","Draft Ticket")}),(0,a.jsx)("div",{className:"text-xs text-zinc-500",children:null==ee?void 0:ee.name})]}),(0,a.jsx)("button",{onClick:()=>B(null),className:"px-3 py-2 rounded-xl text-xs font-black border border-zinc-800 bg-black/35 text-zinc-200 hover:bg-zinc-900/40",children:e("CLOSE","CLOSE")})]}),(null==ee?void 0:ee.draftSetup)?(0,a.jsx)(x,{reservation:ee,dishPresets:R,onUpdateReservationNote:e=>h(ee.id,e),onSetDraftMenu:e=>f(ee.id,e),onSetDraftGuestMenu:(e,t)=>j(ee.id,e,t),onInsertCourseLine:(e,t,n)=>S(ee.id,e,t,n),onDeleteCourseLine:e=>y(ee.id,e),onMoveCourseLine:(e,t)=>T(ee.id,e,t),onAddExtraDish:(e,t)=>C(ee.id,e,t),onRemoveExtraDish:(e,t)=>w(ee.id,e,t),onAddGuestSub:(e,t,n)=>A(String(ee.id),e,t,n),onRemoveGuestSub:e=>D(String(ee.id),e)}):(0,a.jsx)("div",{className:"rounded-2xl border border-zinc-800 bg-zinc-900/40 p-6 text-zinc-500",children:e("No draft setup yet. Create a draft to start editing.","No draft setup yet. Create a draft to start editing.")})]}):(0,a.jsxs)("div",{className:"h-full w-full p-6 overflow-y-auto",children:[(0,a.jsxs)("div",{className:"mb-4 flex items-center gap-2",children:[(0,a.jsxs)("div",{className:"px-3 py-2 rounded-lg border border-zinc-800 bg-black/60 text-xs text-zinc-300",children:[e("Mode","Mode"),": ",(0,a.jsx)("span",{className:"font-bold text-white",children:e("Seating","Seating")})]}),Y&&(0,a.jsxs)("div",{className:"px-3 py-2 rounded-lg border border-blue-700 bg-blue-900/30 text-xs text-blue-100",children:[e("Assign","Assign"),": ",(0,a.jsx)("span",{className:"font-bold",children:Y.name})]})]}),(0,a.jsx)(r.b,{mode:"seating",tables:n,storageKey:"tastingpos_res_active_map_page",selectedReservationId:O,onDropReservationOnTable:(e,t)=>er(e,t),onClickTable:e=>{O&&(er(O,e),L(null))}})]})}),ea?(0,a.jsx)("aside",{className:"hidden md:block h-full overflow-y-auto border-l border-zinc-800 bg-zinc-950 p-4",children:(0,a.jsxs)("div",{className:"rounded-2xl border border-zinc-800 bg-zinc-950/40 p-3",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between mb-3",children:[(0,a.jsx)("div",{className:"text-xs font-black text-zinc-200",children:e("DRAFT PREVIEW","DRAFT PREVIEW")}),(0,a.jsx)("div",{className:"text-[10px] font-black text-zinc-500",children:e("KDS ticket","KDS ticket")})]}),el?(0,a.jsx)("div",{className:"rounded-2xl border border-zinc-800 bg-black/30 p-2",children:(0,a.jsx)(i.wx,{table:el,mode:"PREVIEW",labelMode:"draft",guestSubs:(null==ee?void 0:ee.draftGuestSubs)||[],guestSeatMap:es||void 0})}):(0,a.jsx)("div",{className:"text-sm text-zinc-500",children:e("Create a draft to preview.","Create a draft to preview.")})]})}):null]}),ea?(0,a.jsxs)("div",{className:"md:hidden fixed inset-0 z-40 bg-[#0b0b0d] flex flex-col",children:[(0,a.jsxs)("div",{className:"p-4 border-b border-zinc-800 flex items-center justify-between",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("div",{className:"text-sm font-black text-white",children:e("Draft Ticket","Draft Ticket")}),(0,a.jsx)("div",{className:"text-xs text-zinc-500",children:null==ee?void 0:ee.name})]}),(0,a.jsx)("button",{onClick:()=>B(null),className:"px-3 py-2 rounded-xl text-xs font-black border border-zinc-800 bg-black/35 text-zinc-200 hover:bg-zinc-900/40",children:e("CLOSE","CLOSE")})]}),(0,a.jsxs)("div",{className:"flex-1 overflow-y-auto p-4 space-y-4",children:[(null==ee?void 0:ee.draftSetup)?(0,a.jsx)(x,{reservation:ee,dishPresets:R,onUpdateReservationNote:e=>h(ee.id,e),onSetDraftMenu:e=>f(ee.id,e),onSetDraftGuestMenu:(e,t)=>j(ee.id,e,t),onInsertCourseLine:(e,t,n)=>S(ee.id,e,t,n),onDeleteCourseLine:e=>y(ee.id,e),onMoveCourseLine:(e,t)=>T(ee.id,e,t),onAddExtraDish:(e,t)=>C(ee.id,e,t),onRemoveExtraDish:(e,t)=>w(ee.id,e,t),onAddGuestSub:(e,t,n)=>A(String(ee.id),e,t,n),onRemoveGuestSub:e=>D(String(ee.id),e)}):(0,a.jsx)("div",{className:"rounded-2xl border border-zinc-800 bg-zinc-900/40 p-6 text-zinc-500",children:e("No draft setup yet. Create a draft to start editing.","No draft setup yet. Create a draft to start editing.")}),(0,a.jsxs)("div",{className:"rounded-2xl border border-zinc-800 bg-zinc-950/40 p-3",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between mb-3",children:[(0,a.jsx)("div",{className:"text-xs font-black text-zinc-200",children:e("DRAFT PREVIEW","DRAFT PREVIEW")}),(0,a.jsx)("div",{className:"text-[10px] font-black text-zinc-500",children:e("KDS ticket","KDS ticket")})]}),el?(0,a.jsx)("div",{className:"rounded-2xl border border-zinc-800 bg-black/30 p-2",children:(0,a.jsx)(i.wx,{table:el,mode:"PREVIEW",labelMode:"draft",guestSubs:(null==ee?void 0:ee.draftGuestSubs)||[],guestSeatMap:es||void 0})}):(0,a.jsx)("div",{className:"text-sm text-zinc-500",children:e("Create a draft to preview.","Create a draft to preview.")})]})]})]}):null,$?(0,a.jsx)("div",{className:"fixed inset-0 bg-black/60 backdrop-blur-sm z-50 flex items-end md:items-center justify-center p-4",children:(0,a.jsxs)("div",{className:"w-full max-w-2xl rounded-2xl border border-zinc-800 bg-[#0f0f12] overflow-hidden",children:[(0,a.jsxs)("div",{className:"px-4 py-3 border-b border-zinc-800 flex items-center justify-between",children:[(0,a.jsx)("div",{className:"text-sm font-black text-white",children:e("Edit reservation","Edit reservation")}),(0,a.jsx)("button",{onClick:()=>q(null),className:"px-3 py-2 rounded-xl text-xs font-black border border-zinc-800 bg-black/35 text-zinc-200 hover:bg-zinc-900/40",children:e("CLOSE","CLOSE")})]}),(0,a.jsxs)("div",{className:"p-4 grid grid-cols-2 gap-3",children:[(0,a.jsx)(b,{label:e("Name","Name"),children:(0,a.jsx)("input",{className:u,value:$.name,onChange:e=>v($.id,{name:e.target.value})})}),(0,a.jsx)(b,{label:e("Phone","Phone"),children:(0,a.jsx)("input",{className:u,value:$.phone||"",onChange:e=>v($.id,{phone:e.target.value})})}),(0,a.jsx)(b,{label:e("Email","Email"),children:(0,a.jsx)("input",{className:u,value:$.email||"",onChange:e=>v($.id,{email:e.target.value})})}),(0,a.jsx)(b,{label:e("Pax","Pax"),children:(0,a.jsx)("input",{type:"number",className:u,value:$.pax,onChange:e=>v($.id,{pax:parseInt(e.target.value||"1",10)})})}),(0,a.jsx)(b,{label:e("Date","Date"),children:(0,a.jsx)("input",{type:"date",className:u,value:$.date||W,onChange:e=>v($.id,{date:e.target.value})})}),(0,a.jsx)(b,{label:e("Service","Service"),children:(0,a.jsxs)("select",{className:u,value:$.service||K,onChange:e=>v($.id,{service:e.target.value}),children:[(0,a.jsx)("option",{value:"LUNCH",children:e("LUNCH","LUNCH")}),(0,a.jsx)("option",{value:"DINNER",children:e("DINNER","DINNER")})]})}),(0,a.jsx)(b,{label:e("Status","Status"),children:(0,a.jsxs)("select",{className:u,value:$.status||"BOOKED",onChange:e=>v($.id,{status:e.target.value}),children:[(0,a.jsx)("option",{value:"BOOKED",children:e("BOOKED","BOOKED")}),(0,a.jsx)("option",{value:"ARRIVED",children:e("ARRIVED","ARRIVED")}),(0,a.jsx)("option",{value:"NO_SHOW",children:e("NO SHOW","NO SHOW")}),(0,a.jsx)("option",{value:"CANCELLED",children:e("CANCELLED","CANCELLED")})]})}),(0,a.jsx)(b,{label:e("Channel","Channel"),children:(0,a.jsx)("input",{className:u,value:$.channel||"",onChange:e=>v($.id,{channel:e.target.value})})}),(0,a.jsxs)("div",{className:"col-span-2",children:[(0,a.jsx)("div",{className:"text-xs font-black text-zinc-300 mb-2",children:e("Reservation notes (hidden unless opened)","Reservation notes (hidden unless opened)")}),(0,a.jsx)("textarea",{className:"".concat(u," min-h-[90px]"),value:$.reservationNote||"",onChange:e=>h($.id,e.target.value)})]}),(0,a.jsxs)("div",{className:"col-span-2",children:[(0,a.jsx)("div",{className:"text-xs font-black text-zinc-300 mb-2",children:e("Allergies (reservation level)","Allergies (reservation level)")}),(0,a.jsx)("input",{className:u,value:$.allergies||"",onChange:e=>v($.id,{allergies:e.target.value})})]}),(0,a.jsxs)("div",{className:"col-span-2 flex items-center justify-between pt-2",children:[(0,a.jsx)("button",{onClick:()=>{N($.id),q(null)},className:"px-4 py-2 rounded-xl text-xs font-black border border-red-700 bg-red-900/20 text-red-200 hover:bg-red-900/30",children:e("DELETE","DELETE")}),(0,a.jsx)("div",{className:"text-xs text-zinc-500",children:e("Auto-saved (offline)","Auto-saved (offline)")})]})]})]})}):null]})}function x(e){let{reservation:t,dishPresets:n,onUpdateReservationNote:r,onSetDraftMenu:c,onSetDraftGuestMenu:x,onInsertCourseLine:b,onDeleteCourseLine:u,onMoveCourseLine:m,onAddExtraDish:p,onRemoveExtraDish:v,onAddGuestSub:h,onRemoveGuestSub:g}=e,{t:N}=(0,o.Q)(),f=t.draftSetup,[j,E]=s.useState(null),[z,k]=s.useState("A"),[S,y]=s.useState(""),[T,C]=s.useState(!1),w=(0,l.NK)(t.pax||1),R=s.useCallback(e=>{let t=w[e-1];return t?"".concat(N("Guest","Guest")," ").concat(t):"".concat(N("Seat","Seat")," ").concat(e)},[w]),A=s.useMemo(()=>(0,d.ri)().menus||[],[]),D=t.draftMenuId||f.menuId;return s.useEffect(()=>{w.includes(z)||k(w[0])},[z,w]),(0,a.jsxs)("div",{className:"mt-2 space-y-4",children:[(0,a.jsxs)("div",{className:"rounded-2xl border border-zinc-800 bg-zinc-900/40 p-4",children:[(0,a.jsxs)("div",{className:"flex flex-wrap gap-2 items-center",children:[(0,a.jsx)("span",{className:"px-3 py-1 rounded border border-zinc-700 bg-zinc-950 text-sm font-black text-zinc-200",children:t.name}),(0,a.jsxs)("span",{className:"px-3 py-1 rounded border border-zinc-700 bg-zinc-950 text-sm font-black text-zinc-200",children:[t.pax," ",N("PAX","PAX")]}),(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)("span",{className:"text-[10px] font-black text-zinc-400",children:N("MENU","MENU")}),(0,a.jsx)("select",{value:D,onChange:e=>{(!t.draftGuestSubs||!(t.draftGuestSubs.length>0)||window.confirm(N("Changing menu may clear guest substitutions if courses don't match. Continue?","Changing menu may clear guest substitutions if courses don't match. Continue?")))&&c(e.target.value)},className:"rounded-xl bg-black/60 border border-zinc-800 text-white px-3 py-2 text-sm",children:A.map(e=>(0,a.jsx)("option",{value:e.id,children:e.label},e.id))})]})]}),(0,a.jsxs)("div",{className:"mt-3 rounded-xl border border-zinc-800 bg-black/40 overflow-hidden",children:[(0,a.jsxs)("button",{onClick:()=>C(e=>!e),className:"w-full px-3 py-2 flex items-center justify-between text-left",children:[(0,a.jsx)("div",{className:"text-[10px] font-black text-zinc-300",children:N("RESERVATION NOTES","RESERVATION NOTES")}),(0,a.jsx)("div",{className:"text-[10px] font-black text-amber-300",children:T?N("HIDE","HIDE"):N("SHOW","SHOW")})]}),T?(0,a.jsx)("div",{className:"px-3 pb-3",children:(0,a.jsx)("textarea",{value:t.reservationNote||"",onChange:e=>r(e.target.value),onBlur:e=>r(e.target.value),placeholder:N("Add reservation notes…","Add reservation notes…"),className:"w-full min-h-[80px] rounded-xl bg-black/60 border border-zinc-800 text-white px-3 py-2 text-sm outline-none focus:border-amber-500/80"})}):null]})]}),(0,a.jsxs)("div",{className:"mt-3 rounded-2xl border border-zinc-800 bg-zinc-900/40 overflow-hidden",children:[(0,a.jsxs)("div",{className:"px-4 py-3 border-b border-zinc-800 bg-zinc-950",children:[(0,a.jsx)("div",{className:"text-sm font-black text-white",children:N("GUEST MENU (DRAFT)","GUEST MENU (DRAFT)")}),(0,a.jsx)("div",{className:"text-xs text-zinc-500 mt-1",children:N("Choose menu per guest. Seat assignment happens in Room when they arrive.","Choose menu per guest. Seat assignment happens in Room when they arrive.")})]}),(0,a.jsx)("div",{className:"p-4 space-y-3",children:(0,l.NK)(t.pax).map(e=>{var n,s,l;let r=(null===(n=t.draftGuestMenuMap)||void 0===n?void 0:n[e])||(null===(s=t.draftGuestMenuId)||void 0===s?void 0:s[e])||t.draftMenuId||(null===(l=A[0])||void 0===l?void 0:l.id);return(0,a.jsxs)("div",{className:"rounded-2xl border border-zinc-800 bg-black/40 p-4",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)("div",{className:"text-white font-black",children:[N("Guest","Guest")," ",e]}),(0,a.jsx)("div",{className:"text-[10px] font-black text-zinc-500",children:N("Draft","Draft")})]}),(0,a.jsxs)("div",{className:"mt-3 flex items-center justify-between gap-3",children:[(0,a.jsx)("div",{className:"text-xs font-black text-zinc-300",children:N("MENU","MENU")}),(0,a.jsx)("select",{value:r,onChange:t=>x(e,t.target.value),className:"w-[220px] rounded-xl bg-black/60 border border-zinc-800 text-white px-3 py-2 text-sm outline-none focus:border-amber-500/80",children:A.map(e=>(0,a.jsx)("option",{value:e.id,children:e.label},e.id))})]})]},e)})})]}),(0,a.jsxs)("div",{className:"rounded-2xl border border-zinc-800 bg-zinc-900/40 overflow-hidden",children:[(0,a.jsxs)("div",{className:"px-4 py-3 border-b border-zinc-800 bg-zinc-950 flex items-center justify-between",children:[(0,a.jsx)("div",{className:"text-sm font-black text-white",children:N("SUBSTITUTIONS PER GUEST","SUBSTITUTIONS PER GUEST")}),(0,a.jsx)("div",{className:"text-xs text-zinc-500",children:N("Tap a course → add guest substitutions","Tap a course → add guest substitutions")})]}),(0,a.jsx)("div",{className:"divide-y divide-zinc-800",children:f.courseLines.map(e=>{var s;let l=(t.draftGuestSubs||[]).filter(t=>t.courseId===e.id);return(0,a.jsxs)("div",{className:"p-4",children:[(0,a.jsxs)("button",{onClick:()=>E(t=>t===e.id?null:e.id),className:"w-full text-left flex items-start justify-between gap-3",children:[(0,a.jsxs)("div",{children:[(()=>{let n=(0,i.Di)(e,t.pax);return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)("div",{className:"text-white font-black",children:[(0,a.jsxs)("span",{className:"text-zinc-400 font-mono text-xs",children:["#",e.idx]})," ",n.baseCount,"x ",n.baseDish]}),n.exceptions.length>0?(0,a.jsx)("div",{className:"mt-1 text-xs text-zinc-400 space-y-1",children:n.exceptions.map(e=>(0,a.jsxs)("div",{children:[(0,a.jsxs)("span",{className:"font-black text-zinc-300",children:[R(e.seat)," →"]})," ",e.dish]},e.seat))}):null]})})(),(0,a.jsx)("div",{className:"text-xs text-zinc-500 mt-1",children:l.length>0?N("Guest substitutions set","Guest substitutions set"):N("No guest substitutions","No guest substitutions")})]}),(0,a.jsx)("div",{className:"text-xs font-black text-zinc-300",children:j===e.id?N("CLOSE","CLOSE"):N("EDIT","EDIT")})]}),j===e.id&&(0,a.jsxs)("div",{children:[(0,a.jsxs)("div",{className:"mt-4 rounded-2xl border border-zinc-800 bg-black/30 p-3",children:[(0,a.jsx)("div",{className:"text-xs font-black text-zinc-300",children:N("SUBSTITUTIONS PER GUEST (DRAFT)","SUBSTITUTIONS PER GUEST (DRAFT)")}),(0,a.jsxs)("div",{className:"mt-2 grid grid-cols-2 gap-2",children:[(0,a.jsx)("select",{value:z,onChange:e=>k(e.target.value),className:"rounded-xl bg-black/60 border border-zinc-800 text-white px-3 py-2 text-sm font-black",children:w.map(e=>(0,a.jsxs)("option",{value:e,children:[N("Guest","Guest")," ",e]},e))}),(0,a.jsx)("input",{value:S,onChange:e=>y(e.target.value),placeholder:N("Type substitute (e.g. feijoa)","Type substitute (e.g. feijoa)"),className:"rounded-xl bg-black/60 border border-zinc-800 text-white px-3 py-2 text-sm"})]}),(0,a.jsx)("button",{onClick:()=>{S.trim()&&(h(e.id,z,S),y(""))},className:"mt-2 w-full rounded-xl bg-amber-500 text-black font-black py-2 text-sm",children:N("ADD SUBSTITUTION","ADD SUBSTITUTION")}),(0,a.jsx)("div",{className:"mt-3 space-y-2",children:0===l.length?(0,a.jsx)("div",{className:"text-xs text-zinc-500",children:N("No guest substitutions yet.","No guest substitutions yet.")}):l.map(e=>(0,a.jsxs)("div",{className:"flex items-center justify-between rounded-xl border border-zinc-800 bg-black/40 px-3 py-2",children:[(0,a.jsxs)("div",{className:"text-sm text-white",children:[(0,a.jsxs)("span",{className:"font-black",children:[N("Guest","Guest")," ",e.guest]}),(0,a.jsx)("span",{className:"text-zinc-400",children:" — "}),(0,a.jsx)("span",{className:"font-semibold",children:e.text})]}),(0,a.jsx)("button",{onClick:()=>g(e.id),className:"rounded-lg border border-zinc-700 bg-black/40 px-2 py-1 text-xs font-black text-zinc-200",children:N("REMOVE","REMOVE")})]},e.id))})]}),(0,a.jsxs)("div",{className:"mt-4 rounded-xl border border-zinc-800 bg-black p-3",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between gap-2",children:[(0,a.jsx)("div",{className:"text-[11px] font-black text-zinc-300",children:N("EXTRA DISHES (THIS COURSE)","EXTRA DISHES (THIS COURSE)")}),(0,a.jsxs)("select",{defaultValue:"",onChange:t=>{let n=t.target.value;if(n){if("__custom__"===n){var a;let n=(null===(a=prompt(N("Extra dish name?","Extra dish name?")))||void 0===a?void 0:a.trim())||"";n&&p(e.id,n),t.currentTarget.value="";return}p(e.id,n),t.currentTarget.value=""}},className:"rounded-lg bg-zinc-950 border border-zinc-800 text-white px-3 py-2 text-sm outline-none focus:border-amber-500",children:[(0,a.jsx)("option",{value:"",children:N("+ Add dish…","+ Add dish…")}),n.map(e=>(0,a.jsx)("option",{value:e,children:e},e)),(0,a.jsx)("option",{value:"__custom__",children:N("Custom…","Custom…")})]})]}),(0,a.jsx)("div",{className:"mt-2 space-y-2",children:((null===(s=f.extrasByCourseId)||void 0===s?void 0:s[e.id])||[]).map((t,n)=>(0,a.jsxs)("div",{className:"flex items-center justify-between gap-2 rounded-lg border border-zinc-800 bg-zinc-950 p-2",children:[(0,a.jsx)("div",{className:"text-sm text-white font-black truncate",children:t}),(0,a.jsx)("button",{onClick:()=>v(e.id,n),className:"px-3 py-1.5 rounded-lg border border-zinc-700 bg-black/40 text-xs font-black text-zinc-200 hover:bg-zinc-900/40",children:N("DELETE","DELETE")})]},"".concat(t,"_").concat(n)))})]}),(0,a.jsxs)("div",{className:"mt-3 flex flex-wrap gap-2",children:[(0,a.jsx)("button",{className:"px-3 py-2 rounded-xl text-xs font-black border border-zinc-700 bg-black/40 text-zinc-200 hover:bg-zinc-900/40",onClick:()=>{var t;let n=(null===(t=prompt(N("Course name?","Course name?")))||void 0===t?void 0:t.trim())||"";n&&b(e.id,"BEFORE",n)},children:N("+ ADD BEFORE","+ ADD BEFORE")}),(0,a.jsx)("button",{className:"px-3 py-2 rounded-xl text-xs font-black border border-zinc-700 bg-black/40 text-zinc-200 hover:bg-zinc-900/40",onClick:()=>{var t;let n=(null===(t=prompt(N("Course name?","Course name?")))||void 0===t?void 0:t.trim())||"";n&&b(e.id,"AFTER",n)},children:N("+ ADD AFTER","+ ADD AFTER")}),(0,a.jsx)("button",{className:"px-3 py-2 rounded-xl text-xs font-black border border-zinc-700 bg-black/40 text-zinc-200 hover:bg-zinc-900/40",onClick:()=>m(e.id,-1),children:N("↑ MOVE","↑ MOVE")}),(0,a.jsx)("button",{className:"px-3 py-2 rounded-xl text-xs font-black border border-zinc-700 bg-black/40 text-zinc-200 hover:bg-zinc-900/40",onClick:()=>m(e.id,1),children:N("↓ MOVE","↓ MOVE")}),(0,a.jsx)("button",{className:"px-3 py-2 rounded-xl text-xs font-black border border-red-700 bg-red-900/20 text-red-200 hover:bg-red-900/30",onClick:()=>u(e.id),children:N("DELETE COURSE","DELETE COURSE")})]})]})]},e.id)})})]})]})}function b(e){let{label:t,children:n}=e;return(0,a.jsxs)("div",{children:[(0,a.jsx)("div",{className:"text-xs font-black text-zinc-300 mb-2",children:t}),n]})}let u="w-full rounded-xl bg-black/60 border border-zinc-800 text-white px-3 py-2 text-sm outline-none focus:border-amber-500/80"}},function(e){e.O(0,[459,310,376,971,23,744],function(){return e(e.s=2105)}),_N_E=e.O()}]);