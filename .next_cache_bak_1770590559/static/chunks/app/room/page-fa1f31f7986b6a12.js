(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[261],{7670:function(e,t,l){Promise.resolve().then(l.bind(l,775))},514:function(e,t,l){"use strict";l.d(t,{b:function(){return r}});var s=l(7437),a=l(2265);function n(e,t){let l={};for(let[i,r]of Object.entries(e||{})){var s,a,n;let e=Number(i);e&&r&&(l[e]={id:e,name:r.name,x:r.x,y:r.y,w:null!==(s=r.w)&&void 0!==s?s:92,h:null!==(a=r.h)&&void 0!==a?a:92,obj:null!==(n=r.obj)&&void 0!==n?n:r.shape,..."legacy"===t?{main:r.main}:{pageId:r.pageId}})}return l}var i=l(1459);function r(e){var t,l,r;let{tables:d,mode:o="service",storageKey:c,selectedReservationId:x,onDropReservationOnTable:b,onClickTable:u,activePageId:m,onChangePage:p}=e,{t:v}=(0,i.Q)(),h=c||"tastingpos_room_active_map_page",[N,g]=a.useState(null),[f,j]=a.useState(null!=m?m:null);a.useEffect(()=>{g(function(){let e=window.localStorage.getItem("tastingpos_layout_v6"),t=window.localStorage.getItem("tastingpos_layout_v5"),l=e=>{if(!e)return null;try{return JSON.parse(e)}catch(e){return null}},s=l(e);if(s&&Array.isArray(s.pages)){let e=s.pageRects||{};for(let t of s.pages)e[t.id]||(e[t.id]={x:0,y:0,w:900,h:756});return{kind:"pages",pages:s.pages,rectByPage:e,zones:s.zones||[],walls:s.walls||[],tableById:n(s.tables||{},"pages")}}let a=l(t);if(a&&a.mains){let e=a.mainLabels||{RESTAURANTE:"RESTAURANTE",TERRAZA:"TERRAZA",VIP:"ZONA VIP"},t=["RESTAURANTE","TERRAZA","VIP"].map(t=>({id:t,label:e[t]||t})),l={};for(let e of["RESTAURANTE","TERRAZA","VIP"])l[e]=a.mains[e]||{x:0,y:0,w:900,h:756};return{kind:"legacy",pages:t,rectByPage:l,zones:a.zones||[],walls:a.walls||[],tableById:n(a.tables||{},"legacy")}}return null}())},[]),a.useEffect(()=>{void 0!==m&&j(m)},[m]);let E=(null==N?void 0:N.pages)||[{id:"RESTAURANTE",label:v("RESTAURANTE","RESTAURANTE")}];a.useEffect(()=>{!f&&E.length&&j(E[0].id)},[f,E]),a.useEffect(()=>{if(N)try{let e=localStorage.getItem(h);e&&E.some(t=>t.id===e)&&j(e)}catch(e){}},[N,E,h]);let S=f||(null!==(r=null===(t=E[0])||void 0===t?void 0:t.id)&&void 0!==r?r:v("RESTAURANTE","RESTAURANTE")),z=(null==N?void 0:null===(l=N.rectByPage)||void 0===l?void 0:l[S])||{x:0,y:0,w:900,h:756},k=((null==N?void 0:N.zones)||[]).filter(e=>{var t;return(null!==(t=e.pageId)&&void 0!==t?t:e.main)===S}),y=((null==N?void 0:N.walls)||[]).filter(e=>{var t;return(null!==(t=e.pageId)&&void 0!==t?t:e.main)===S}),w=(null==N?void 0:N.tableById)||{},A=d.filter(e=>{var t;let l=w[e.id];return((null!==(t=null==l?void 0:l.pageId)&&void 0!==t?t:null==l?void 0:l.main)||e.pageId||e.main)===S}).map(e=>{var t,l,s,a,n,i,r,d,o,c;let x=w[e.id],b=null!==(l=null!==(t=null==x?void 0:x.w)&&void 0!==t?t:e.w)&&void 0!==l?l:92,u=null!==(a=null!==(s=null==x?void 0:x.h)&&void 0!==s?s:e.h)&&void 0!==a?a:92,m=null!==(i=null!==(n=null==x?void 0:x.x)&&void 0!==n?n:e.x)&&void 0!==i?i:z.x+80,p=null!==(d=null!==(r=null==x?void 0:x.y)&&void 0!==r?r:e.y)&&void 0!==d?d:z.y+80,v=null!==(c=null!==(o=null==x?void 0:x.obj)&&void 0!==o?o:e.obj)&&void 0!==c?c:"TABLE_SQUARE";return{table:e,lt:{x:m,y:p,w:b,h:u,obj:v}}}),I=e=>{j(e),null==p||p(e);try{localStorage.setItem(h,e)}catch(e){}},T=e=>{"seating"===o&&(e.preventDefault(),e.dataTransfer.dropEffect="move")},R=(e,t)=>{if("seating"!==o)return;e.preventDefault();let l=e.dataTransfer.getData("text/plain");l&&(null==b||b(l,t))};return(0,s.jsxs)("div",{className:"h-full w-full",children:[(0,s.jsx)("div",{className:"flex items-center gap-2 mb-3",children:E.map(e=>(0,s.jsx)("button",{onClick:()=>I(e.id),className:["px-4 py-2 rounded-xl text-xs font-black border transition",S===e.id?"bg-amber-500 text-black border-amber-400":"bg-zinc-950/40 text-zinc-200 border-zinc-800 hover:bg-zinc-900/40"].join(" "),children:e.label},e.id))}),(0,s.jsxs)("div",{className:"relative rounded-2xl border border-zinc-800 bg-black/30 overflow-hidden",children:[(0,s.jsx)("div",{className:"absolute inset-0 pointer-events-none",style:{backgroundImage:"linear-gradient(to right, rgba(255,255,255,0.10) 1px, transparent 1px), linear-gradient(to bottom, rgba(255,255,255,0.10) 1px, transparent 1px)",backgroundSize:"20px 20px",opacity:.06}}),(0,s.jsx)("div",{className:"absolute inset-0 pointer-events-none shadow-[inset_0_0_120px_rgba(0,0,0,0.85)]"}),(0,s.jsx)("div",{className:"relative p-4",children:(0,s.jsxs)("div",{className:"relative rounded-2xl border border-zinc-800/80 overflow-hidden bg-gradient-to-b from-zinc-950/40 to-black/40",style:{width:z.w,height:z.h},children:[k.map(e=>(0,s.jsx)("div",{className:"absolute rounded-2xl border border-zinc-800/80 bg-zinc-900/10",style:{left:e.x-z.x,top:e.y-z.y,width:e.w,height:e.h},children:e.label?(0,s.jsx)("div",{className:"absolute top-2 left-2 text-[10px] font-black px-2 py-1 rounded-lg border border-zinc-800 bg-black/40 text-zinc-200",children:e.label}):null},e.id)),y.map(e=>(0,s.jsx)("div",{className:"absolute rounded border border-zinc-800/80 bg-zinc-500/40",style:{left:e.x-z.x,top:e.y-z.y,width:e.w,height:e.h}},e.id)),A.map(e=>{let{table:t,lt:l}=e,a="ASSIGNED"===t.reservationStatus,n="SEATED"===t.reservationStatus||"SEATED"===t.status,i="TABLE_ROUND"===l.obj;return(0,s.jsxs)("div",{onClick:()=>null==u?void 0:u(t.id),onDragOver:T,onDrop:e=>R(e,t.id),className:["absolute select-none border backdrop-blur-md overflow-hidden",i?"rounded-full":"rounded-2xl",x&&"seating"===o?"cursor-pointer hover:scale-[1.01]":"cursor-default",n?"border-emerald-500/60 bg-black/40":a?"border-amber-500/60 bg-black/35":"border-zinc-800/90 bg-black/25"].join(" "),style:{left:l.x-z.x,top:l.y-z.y,width:l.w,height:l.h},title:t.name,children:[(0,s.jsx)("div",{className:"absolute inset-0 pointer-events-none [background:radial-gradient(circle_at_30%_20%,rgba(255,255,255,0.10),transparent_55%)]"}),t.tableLanguage?(0,s.jsx)("div",{className:"absolute top-1 right-1 px-2 py-1 rounded-lg border border-zinc-800 bg-black/50 text-[10px] font-black text-zinc-200",children:t.tableLanguage}):null,(0,s.jsxs)("div",{className:"absolute inset-0 flex flex-col items-center justify-center",children:[(0,s.jsx)("div",{className:"text-[14px] font-black text-white",children:t.name}),n&&t.reservationName?(0,s.jsx)("div",{className:"mt-1 text-[11px] font-semibold text-zinc-300 max-w-[90%] truncate",children:t.reservationName}):null,a&&!n&&t.reservationName?(0,s.jsxs)("div",{className:"mt-1 text-[11px] font-semibold text-amber-200 max-w-[90%] truncate",children:[v("Assigned","Assigned"),": ",t.reservationName]}):null,n||a||"seating"!==o?null:(0,s.jsx)("div",{className:"mt-1 text-[10px] text-zinc-500",children:v("Drop reservation","Drop reservation")})]})]},t.id)})]})}),(0,s.jsx)("div",{className:"px-4 pb-4 text-xs text-zinc-500",children:"seating"===o?v("Seating mode: drag reservation onto table","Seating mode: drag reservation onto table"):v("Service mode: map is read-only","Service mode: map is read-only")})]})]})}},775:function(e,t,l){"use strict";l.r(t),l.d(t,{default:function(){return c}});var s=l(7437),a=l(2265),n=l(4310),i=l(514),r=l(5376),d=l(7188),o=l(1459);function c(){var e;let{t}=(0,o.Q)(),{tables:l,hasAllergyFlag:r,getOnCourse:d}=(0,n.mr)(),[c,x]=a.useState(null),u="tastingpos_room_active_table",[m,p]=a.useState(!1),[v,h]=a.useState(!0),[N,g]=a.useState(!0),[f,j]=a.useState(!1),E=window.innerWidth<768,S=a.useCallback(e=>{x(e);try{localStorage.setItem(u,String(e))}catch(e){}},[]),z=a.useMemo(()=>l.find(e=>e.id===c)||null,[l,c]),k=z?null!==(e=z.reservationStatus)&&void 0!==e?e:"SEATED"===z.status?"SEATED":"NONE":"NONE",y=l.filter(e=>"SEATED"===e.status).length;a.useEffect(()=>{try{let e=localStorage.getItem(u);if(!e)return;let t=Number(e);if(!t)return;let s=l.find(e=>e.id===t);s&&"SEATED"===s.status&&x(t)}catch(e){}},[]),a.useEffect(()=>{p(!1),h(!0),g(!0)},[c]);let w=(0,s.jsx)("div",{className:"w-full h-full overflow-hidden touch-none",children:(0,s.jsx)(i.b,{mode:"service",tables:l,storageKey:"tastingpos_room_active_map_page",onClickTable:e=>S(e)})}),A=z&&("ASSIGNED"===k||"SEATED"===k)?(0,s.jsx)(b,{table:z,showResNote:m,setShowResNote:p,showFohNote:v,setShowFohNote:h,showFullMenu:N,setShowFullMenu:g}):(0,s.jsxs)("div",{className:"text-zinc-500",children:[(0,s.jsx)("div",{className:"text-white font-black text-lg",children:t("Room Control","Room Control")}),(0,s.jsx)("div",{className:"mt-2",children:t("Select a seated table to manage it.","Select a seated table to manage it.")})]});return E?(0,s.jsxs)("div",{className:"h-[100dvh] w-full relative bg-black",children:[(0,s.jsx)("div",{className:"absolute inset-0",children:w}),(0,s.jsxs)("div",{className:"absolute top-0 left-0 right-0 p-3 flex justify-between items-center bg-black/50 backdrop-blur",children:[(0,s.jsx)("div",{className:"text-white font-black text-sm",children:t("ROOM","ROOM")}),(0,s.jsx)("button",{onClick:()=>j(!0),className:"px-4 py-2 rounded-xl bg-amber-500 text-black font-black text-xs",children:t("OPEN PANEL","OPEN PANEL")})]}),f?(0,s.jsxs)("div",{className:"absolute inset-0",children:[(0,s.jsx)("button",{onClick:()=>j(!1),className:"absolute inset-0 bg-black/50"}),(0,s.jsxs)("div",{className:"absolute bottom-0 left-0 right-0 max-h-[80dvh] rounded-t-3xl border border-zinc-800 bg-[#0f0f12] p-4 overflow-y-auto",children:[(0,s.jsxs)("div",{className:"flex items-center justify-between",children:[(0,s.jsx)("div",{className:"text-white font-black",children:t("PANEL","PANEL")}),(0,s.jsx)("button",{onClick:()=>j(!1),className:"px-3 py-2 rounded-xl border border-zinc-800 bg-black/40 text-zinc-200 font-black text-xs",children:t("CLOSE","CLOSE")})]}),(0,s.jsx)("div",{className:"mt-4",children:A})]})]}):null]}):(0,s.jsxs)("div",{className:"h-full w-full bg-[#0f0f12] flex",children:[(0,s.jsxs)("div",{className:"flex-1 p-6 overflow-y-auto",children:[(0,s.jsxs)("div",{className:"flex items-end justify-between",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("div",{className:"text-2xl font-black text-white",children:t("Room","Room")}),(0,s.jsx)("div",{className:"text-zinc-400 text-sm mt-1",children:t("Tap a table on the map to manage menu + pacing.","Tap a table on the map to manage menu + pacing.")})]}),(0,s.jsxs)("div",{className:"text-xs text-zinc-500",children:[t("Seated","Seated"),": ",(0,s.jsx)("span",{className:"text-white font-black",children:y})]})]}),(0,s.jsx)("div",{className:"mt-6",children:w})]}),(0,s.jsx)("aside",{className:"w-[520px] border-l border-zinc-800 bg-black p-6 overflow-y-auto",children:A})]})}function x(e){let{kind:t,t:l}=e;return"NONE"===t?(0,s.jsx)("span",{className:"text-[10px] font-black px-2 py-1 rounded border border-zinc-700 bg-zinc-950 text-zinc-300",children:l("NOT SENT","NOT SENT")}):"PENDING"===t?(0,s.jsx)("span",{className:"text-[10px] font-black px-2 py-1 rounded border border-amber-600 bg-amber-900/25 text-amber-200",children:l("PENDING","PENDING")}):(0,s.jsx)("span",{className:"text-[10px] font-black px-2 py-1 rounded border border-green-600 bg-green-900/25 text-green-200",children:l("APPROVED","APPROVED")})}function b(e){var t,l,i,c;let{table:b,showResNote:m,setShowResNote:p,showFohNote:v,setShowFohNote:h,showFullMenu:N,setShowFullMenu:g}=e,{sendForApproval:f,setPaused:j,fireNextOrRefire:E,hasAllergyFlag:S,getOnCourse:z,setMenuForTable:k,setPairing:y,setAllergy:w,setWineOverride:A,setFohNote:I,toggleWineMenuPassed:T,toggleWineOrdered:R,clearReservationFromTable:P,setTableLanguage:O,setSeatMenu:D,getFireCooldownSeconds:G,reservations:C,draftAssignGuestToSeat:M,draftRemoveGuestSub:U,draftSetGuestMenu:L,getEffectiveDraftSetupForTable:F}=(0,n.mr)(),{t:_}=(0,o.Q)(),[W,V]=a.useState(()=>Date.now());a.useEffect(()=>{let e=setInterval(()=>V(Date.now()),1e3);return()=>clearInterval(e)},[]);let B="ASSIGNED"===(null!==(i=b.reservationStatus)&&void 0!==i?i:"SEATED"===b.status?"SEATED":"NONE"),H="SEATED"===b.status,K=a.useMemo(()=>b.reservationId&&C.find(e=>e.id===b.reservationId)||null,[C,b.reservationId]),X=H?b.setup:null==K?void 0:K.draftSetup,Q=a.useMemo(()=>{if(!K)return null;let e=K.pax||b.pax;return F(K,e)},[K,b.pax,F]),Z=null!==(c=null==X?void 0:X.approval)&&void 0!==c?c:"NONE",Y=a.useMemo(()=>(0,d.ri)(),[]).menus||[],q=(null===(t=Y.find(e=>e.id===(null==X?void 0:X.menuId)))||void 0===t?void 0:t.label)||_("Menu","Menu"),J=a.useRef(null),$=a.useRef(null),[ee,et]=a.useState(!0),el=(0,n.NK)(b.pax||(null==K?void 0:K.pax)||1),es=a.useMemo(()=>new Set(Object.values((null==K?void 0:K.draftGuestSeatMap)||{}).filter(e=>"number"==typeof e&&e>0)),[null==K?void 0:K.draftGuestSeatMap]);a.useEffect(()=>{K&&(K.draftGuestSubs||[]).length>0&&et(!0)},[null==K?void 0:K.id,null==K?void 0:K.draftUpdatedAt]);let ea=a.useMemo(()=>{if(!(null==K?void 0:K.draftSetup))return null;let e=K.pax||b.pax,t=F(K,e);return{id:-1,name:b.name,pax:e,status:"SEATED",x:0,y:0,reservationName:K.name,reservationPax:K.pax,reservationTime:K.time,language:K.language,setup:t||K.draftSetup}},[K,b.name,b.pax,F]),en=(null==X?void 0:X.courseLines)||[],ei=en.find(e=>"PENDING"===e.status),er=en.find(e=>"FIRED"===e.status)||null,ed=en.filter(e=>"PENDING"===e.status).slice(0,3),eo=!!(null==X?void 0:X.pairing),ec=S(b),ex=z(b),eb=a.useCallback(e=>{var t;if(!(null==X?void 0:X.pairing)||!X.menuId)return null;let l=null===(t=X.wineOverrideByCourseId)||void 0===t?void 0:t[e.id],s=(0,d.$J)(X.menuId,e.idx);return l||(null==s?void 0:s.wineName)||null},[X]),eu=B?{label:_("ASSIGNED","ASSIGNED"),className:"border-amber-600 bg-amber-900/25 text-amber-200"}:(null==X?void 0:X.paused)?{label:_("PAUSED","PAUSED"),className:"border-purple-600 bg-purple-900/20 text-purple-200"}:"PENDING"===Z?{label:_("APPROVAL PENDING","APPROVAL PENDING"),className:"border-amber-600 bg-amber-900/25 text-amber-200"}:"APPROVED"===Z?{label:_("APPROVED","APPROVED"),className:"border-green-600 bg-green-900/25 text-green-200"}:{label:_("SEATED","SEATED"),className:"border-zinc-700 bg-zinc-950 text-zinc-300"},em="NONE"===Z&&H;a.useEffect(()=>{if(!H||!Q||!X||"APPROVED"===Z)return;let e=Q.seatMenuId||{};for(let l=1;l<=b.pax;l++){var t;let s=e[l];s&&(null===(t=X.seatMenuId)||void 0===t?void 0:t[l])!==s&&D(b.id,l,s)}},[H,em,Q,X,b.id,b.pax,D]);let ep=G(b),ev=ep>0,eh="APPROVED"===Z&&!!(null==X?void 0:X.paused)&&!!(null==X?void 0:X.pausedAfterLastFire)&&!!(null==X?void 0:X.lastFiredCourseId)&&!ev,eN="APPROVED"===Z&&!(null==X?void 0:X.paused)&&!!ei&&!ev,eg=eN||eh,ef=eh?_("REFIRE LAST FIRED","REFIRE LAST FIRED"):_("FIRE NEXT COURSE","FIRE NEXT COURSE"),ej=eg?"":ev?"".concat(_("Wait","Wait")," ").concat(ep,"s"):"APPROVED"!==Z?_("Waiting approval","Waiting approval"):(null==X?void 0:X.paused)?_("Table paused","Table paused"):ei?"":_("Nothing to fire","Nothing to fire"),eE=!H;return a.useEffect(()=>{var e;if(!X||!(null===(e=X.courseLines)||void 0===e?void 0:e.find(e=>"FIRED"===e.status)))return;let t=setTimeout(()=>{var e;null===(e=$.current)||void 0===e||e.scrollIntoView({behavior:"smooth",block:"center"})},50);return()=>clearTimeout(t)},[null==X?void 0:X.courseLines]),(0,s.jsxs)("div",{children:[X?(0,s.jsxs)("div",{className:"sticky top-0 z-20 rounded-2xl border border-zinc-800 bg-[#0f0f12]/95 backdrop-blur p-3 mb-4",children:[(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[(0,s.jsx)("button",{disabled:!eN||eE,onClick:()=>{eE||E(b.id)},className:["flex-1 px-4 py-3 rounded-2xl font-black border text-sm transition",eN&&!eE?"bg-amber-500 text-black border-amber-400 hover:bg-amber-400":"bg-zinc-950 text-zinc-500 border-zinc-800 cursor-not-allowed"].join(" "),children:_("FIRE NEXT","FIRE NEXT")}),(0,s.jsx)("button",{disabled:eE,onClick:()=>{eE||j(b.id,!X.paused)},className:["px-4 py-3 rounded-2xl font-black border text-sm transition",X.paused&&!eE?"bg-red-500 text-black border-red-400 hover:bg-red-400":eE?"bg-zinc-950 text-zinc-600 border-zinc-800 cursor-not-allowed":"bg-zinc-950 text-zinc-200 border-zinc-800 hover:bg-zinc-900"].join(" "),children:X.paused?_("RESUME","RESUME"):_("PAUSE","PAUSE")}),(0,s.jsx)("button",{onClick:()=>p(e=>!e),className:"px-4 py-3 rounded-2xl font-black border text-sm bg-zinc-950 text-zinc-200 border-zinc-800 hover:bg-zinc-900",children:_("RES NOTES","RES NOTES")}),(0,s.jsx)("button",{onClick:()=>h(e=>!e),className:"px-4 py-3 rounded-2xl font-black border text-sm bg-zinc-950 text-zinc-200 border-zinc-800 hover:bg-zinc-900",children:_("FOH NOTE","FOH NOTE")}),K?(0,s.jsx)("button",{onClick:()=>et(e=>!e),className:"px-4 py-3 rounded-2xl font-black border text-sm bg-zinc-950 text-zinc-200 border-zinc-800 hover:bg-zinc-900",children:_("GUEST MAPPING","GUEST MAPPING")}):null]}),eN?null:X.approval&&"APPROVED"===X.approval?X.paused?(0,s.jsx)("div",{className:"mt-2 text-xs font-black text-red-300",children:_("Table paused","Table paused")}):null:(0,s.jsx)("div",{className:"mt-2 text-xs font-black text-amber-300",children:_("Waiting kitchen approval","Waiting kitchen approval")})]}):null,v&&X?(0,s.jsxs)("div",{className:"mb-4 rounded-2xl border border-zinc-800 bg-zinc-950/40 p-4",children:[(0,s.jsxs)("div",{className:"flex items-center justify-between",children:[(0,s.jsx)("div",{className:"text-xs font-black text-white",children:_("FOH NOTES","FOH NOTES")}),(0,s.jsx)("div",{className:"text-[10px] text-zinc-500",children:_("Kitchen cannot see this","Kitchen cannot see this")})]}),(0,s.jsx)("textarea",{value:X.fohNote||"",onChange:e=>I(b.id,e.target.value),placeholder:_("Server notes… (VIP mood, pacing requests, birthdays, who pays, etc.)","Server notes… (VIP mood, pacing requests, birthdays, who pays, etc.)"),className:"mt-3 w-full min-h-[70px] rounded-xl bg-black/60 border border-zinc-800 text-white px-3 py-2 text-sm outline-none focus:border-amber-500/80"}),(0,s.jsxs)("div",{className:"mt-3 flex flex-wrap gap-3",children:[(0,s.jsxs)("label",{className:"flex items-center gap-2 px-3 py-2 rounded-xl border border-zinc-800 bg-black/40 text-xs font-black text-zinc-200",children:[(0,s.jsx)("input",{type:"checkbox",checked:!!X.wineMenuPassed,onChange:()=>T(b.id)}),_("Wine menu passed","Wine menu passed")]}),(0,s.jsxs)("label",{className:"flex items-center gap-2 px-3 py-2 rounded-xl border border-zinc-800 bg-black/40 text-xs font-black text-zinc-200",children:[(0,s.jsx)("input",{type:"checkbox",checked:!!X.wineOrdered,onChange:()=>R(b.id)}),_("Wine ordered","Wine ordered")]})]})]}):null,(0,s.jsx)("div",{className:"flex items-start justify-between gap-4",children:(0,s.jsxs)("div",{children:[(0,s.jsxs)("div",{className:"flex items-center gap-3",children:[(0,s.jsx)("div",{className:"text-white font-black text-2xl",children:b.name}),b.tableLanguage?(0,s.jsx)("div",{className:"ml-2 px-2 py-1 rounded-lg border border-zinc-800 bg-black/40 text-[10px] font-black text-zinc-200",children:b.tableLanguage}):null,(0,s.jsx)("span",{className:["text-[10px] font-black px-2 py-1 rounded border",eu.className].join(" "),children:eu.label})]}),(0,s.jsxs)("div",{className:"text-zinc-400 text-sm mt-1",children:[b.reservationName," • ",b.pax," ",_("pax","pax")," • ",b.language]}),(0,s.jsxs)("div",{className:"mt-3 flex flex-wrap gap-2 items-center",children:[(0,s.jsxs)("span",{className:"text-[10px] font-black px-2 py-1 rounded border border-zinc-800 bg-zinc-950 text-zinc-200",children:[_("MENU","MENU")," ",q]}),(0,s.jsx)(x,{kind:Z,t:_}),eo&&(0,s.jsx)("span",{className:"text-[10px] font-black px-2 py-1 rounded border border-indigo-600 bg-indigo-900/20 text-indigo-200",children:_("PAIRING","PAIRING")}),ec&&(0,s.jsx)("span",{className:"text-[10px] font-black px-2 py-1 rounded border border-red-600 bg-red-900/20 text-red-200",children:_("ALLERGY","ALLERGY")}),(null==X?void 0:X.paused)&&(0,s.jsx)("span",{className:"text-[10px] font-black px-2 py-1 rounded border border-purple-600 bg-purple-900/20 text-purple-200",children:_("PAUSED","PAUSED")})]}),(0,s.jsxs)("div",{className:"mt-3 text-sm text-zinc-300",children:[_("On course","On course"),":"," ",(0,s.jsx)("span",{className:"text-white font-black",children:null!==ex?"#".concat(ex):"—"})]})]})}),b.reservationNote?(0,s.jsxs)("div",{className:"mt-4 rounded-2xl border border-zinc-800 bg-zinc-950/40 overflow-hidden",children:[(0,s.jsxs)("button",{onClick:()=>p(e=>!e),className:"w-full px-4 py-3 flex items-center justify-between text-left",children:[(0,s.jsx)("div",{className:"text-xs font-black text-white",children:_("RESERVATION NOTES","RESERVATION NOTES")}),(0,s.jsx)("div",{className:"text-xs font-black text-amber-300",children:m?_("HIDE","HIDE"):_("SHOW","SHOW")})]}),m?(0,s.jsx)("div",{className:"px-4 pb-4 text-sm text-zinc-200",children:b.reservationNote}):null]}):null,B&&!H&&ea?(0,s.jsxs)("div",{className:"mt-4 rounded-2xl border border-zinc-800 bg-zinc-950/40 p-3",children:[(0,s.jsxs)("div",{className:"flex items-center justify-between mb-3",children:[(0,s.jsx)("div",{className:"text-xs font-black text-zinc-200",children:_("DRAFT TICKET PREVIEW (FOH)","DRAFT TICKET PREVIEW (FOH)")}),(0,s.jsx)("div",{className:"text-[10px] font-black text-zinc-500",children:_("Reservation draft","Reservation draft")})]}),(0,s.jsx)("div",{className:"rounded-2xl border border-zinc-800 bg-black/30 p-2",children:(0,s.jsx)(r.wx,{table:ea,mode:"PREVIEW",labelMode:(null==K?void 0:K.draftGuestSeatMap)&&el.every(e=>{var t;return null===(t=K.draftGuestSeatMap)||void 0===t?void 0:t[e]})?"approval":"draft",guestSubs:(null==K?void 0:K.draftGuestSubs)||[],guestSeatMap:(null==K?void 0:K.draftGuestSeatMap)||void 0})})]}):null,B&&!H&&K?(0,s.jsxs)("div",{className:"mt-4 rounded-2xl border border-zinc-800 bg-zinc-950/40 p-4",children:[(0,s.jsx)("div",{className:"text-xs font-black text-white",children:_("GUEST SUBSTITUTIONS","GUEST SUBSTITUTIONS")}),(0,s.jsx)("div",{className:"text-[10px] text-zinc-500 mt-1",children:_("Draft guest notes (pre-seat)","Draft guest notes (pre-seat)")}),(0,s.jsx)("div",{className:"mt-3 space-y-2",children:0===(K.draftGuestSubs||[]).length?(0,s.jsx)("div",{className:"text-xs text-zinc-500",children:_("No guest substitutions yet.","No guest substitutions yet.")}):(K.draftGuestSubs||[]).map(e=>(0,s.jsxs)("div",{className:"flex items-center justify-between rounded-xl border border-zinc-800 bg-black/40 px-3 py-2",children:[(0,s.jsxs)("div",{className:"text-sm text-white",children:[(0,s.jsxs)("span",{className:"font-black",children:[_("Guest","Guest")," ",e.guest]}),(0,s.jsx)("span",{className:"text-zinc-400",children:" — "}),(0,s.jsx)("span",{className:"font-semibold",children:e.text})]}),(0,s.jsx)("button",{onClick:()=>U(K.id,e.id),className:"rounded-lg border border-zinc-700 bg-black/40 px-2 py-1 text-xs font-black text-zinc-200",children:_("REMOVE","REMOVE")})]},e.id))})]}):null,ee&&K?(0,s.jsxs)("div",{className:"mt-4 rounded-2xl border border-zinc-800 bg-zinc-950/40 p-4",children:[(0,s.jsx)("div",{className:"text-xs font-black text-white",children:_("GUEST MAPPING","GUEST MAPPING")}),(0,s.jsx)("div",{className:"text-[10px] text-zinc-500 mt-1",children:_("Assign Guest A/B to seats for approval.","Assign Guest A/B to seats for approval.")}),(0,s.jsx)("div",{className:"mt-3 space-y-2",children:el.map(e=>{var t,l,a,n,i;return(0,s.jsxs)("div",{className:"rounded-xl border border-zinc-800 bg-black/30 p-3",children:[(0,s.jsxs)("div",{className:"flex items-center justify-between gap-3",children:[(0,s.jsxs)("div",{className:"text-sm text-zinc-200 font-black",children:[_("Guest","Guest")," ",e]}),(0,s.jsx)("div",{className:"text-[10px] text-zinc-500",children:(null===(t=K.draftGuestSeatMap)||void 0===t?void 0:t[e])?"".concat(_("Seat","Seat")," ").concat(null===(l=K.draftGuestSeatMap)||void 0===l?void 0:l[e]):_("Unassigned","Unassigned")})]}),(0,s.jsxs)("div",{className:"mt-2 grid grid-cols-2 gap-2",children:[(0,s.jsxs)("select",{value:(null===(a=K.draftGuestSeatMap)||void 0===a?void 0:a[e])||"",onChange:t=>{let l=t.target.value;M(K.id,e,l?Number(l):0)},className:"rounded-lg bg-black/60 border border-zinc-800 text-white px-3 py-2 text-sm w-[130px]",children:[(0,s.jsx)("option",{value:"",children:_("Seat…","Seat…")}),Array.from({length:b.pax||0},(e,t)=>t+1).map(t=>{var l;return(0,s.jsxs)("option",{value:t,disabled:es.has(t)&&(null===(l=K.draftGuestSeatMap)||void 0===l?void 0:l[e])!==t,children:[_("Seat","Seat")," ",t]},t)})]}),(0,s.jsx)("select",{value:(null===(n=K.draftGuestMenuId)||void 0===n?void 0:n[e])||K.draftMenuId||(null===(i=Y[0])||void 0===i?void 0:i.id),onChange:t=>L(K.id,e,t.target.value),className:"rounded-lg bg-black/60 border border-zinc-800 text-white px-3 py-2 text-sm w-[160px]",children:Y.map(e=>(0,s.jsx)("option",{value:e.id,children:e.label},e.id))})]})]},e)})}),(0,s.jsx)("div",{className:"mt-3 text-xs text-zinc-400",children:el.map(e=>{var t;let l=null===(t=K.draftGuestSeatMap)||void 0===t?void 0:t[e];return l?"".concat(_("Guest","Guest")," ").concat(e," → ").concat(_("Seat","Seat")," ").concat(l):null}).filter(Boolean).join(" • ")||_("No guest assignments yet.","No guest assignments yet.")})]}):null,B?(0,s.jsxs)("div",{className:"mt-4 rounded-2xl border border-amber-500/40 bg-amber-500/10 p-4",children:[(0,s.jsx)("div",{className:"text-sm font-black text-white",children:_("TABLE ASSIGNED","TABLE ASSIGNED")}),(0,s.jsx)("div",{className:"text-xs text-zinc-300 mt-1",children:_("Notes visible. Service controls locked until seated.","Notes visible. Service controls locked until seated.")}),(0,s.jsxs)("div",{className:"mt-3 flex gap-2",children:[(0,s.jsx)("button",{onClick:()=>O(b.id,"ING"),disabled:H,className:["px-4 py-2 rounded-xl text-xs font-black border transition",H?"border-zinc-800 bg-zinc-900/40 text-zinc-600 cursor-not-allowed":"border-amber-400 bg-amber-500 text-black hover:bg-amber-400"].join(" "),children:"ING"}),(0,s.jsx)("button",{onClick:()=>O(b.id,"CAST"),disabled:H,className:["px-4 py-2 rounded-xl text-xs font-black border transition",H?"border-zinc-800 bg-zinc-900/40 text-zinc-600 cursor-not-allowed":"border-amber-400 bg-amber-500 text-black hover:bg-amber-400"].join(" "),children:"CAST"}),(0,s.jsx)("button",{onClick:()=>O(b.id,"CAT"),disabled:H,className:["px-4 py-2 rounded-xl text-xs font-black border transition",H?"border-zinc-800 bg-zinc-900/40 text-zinc-600 cursor-not-allowed":"border-amber-400 bg-amber-500 text-black hover:bg-amber-400"].join(" "),children:"CAT"}),(0,s.jsx)("button",{onClick:()=>P(b.id),className:"px-4 py-2 rounded-xl text-xs font-black border border-zinc-800 bg-black/35 text-zinc-200 hover:bg-zinc-900/40 transition",children:_("CLEAR ASSIGNMENT","CLEAR ASSIGNMENT")})]})]}):null,H&&X?(0,s.jsxs)(s.Fragment,{children:[(0,s.jsxs)("div",{className:"mt-6 rounded-2xl border border-zinc-800 bg-zinc-900/40 overflow-hidden",children:[(0,s.jsxs)("div",{className:"px-4 py-3 border-b border-zinc-800 bg-zinc-950 flex items-center justify-between",children:[(0,s.jsx)("div",{className:"text-sm font-black text-white",children:_("SETUP","SETUP")}),(0,s.jsx)("div",{className:"text-xs text-zinc-500",children:em?_("Edit before sending","Edit before sending"):_("Locked after sending","Locked after sending")})]}),(0,s.jsxs)("div",{className:"p-4 space-y-5",children:[(0,s.jsxs)("div",{className:"rounded-2xl border border-zinc-800 bg-zinc-950/40 p-4",children:[(0,s.jsx)("div",{className:"text-xs font-black text-white",children:_("MENU PER SEAT","MENU PER SEAT")}),(0,s.jsx)("div",{className:"text-xs text-zinc-500 mt-1",children:_("Select a menu for each seat (before approval).","Select a menu for each seat (before approval).")}),(0,s.jsx)("div",{className:"mt-3 space-y-2",children:Array.from({length:b.pax},(e,t)=>t+1).map(e=>{var t,l,a;return(0,s.jsxs)("div",{className:"flex items-center justify-between gap-2",children:[(0,s.jsxs)("div",{className:"text-sm font-black text-zinc-200",children:[_("Seat","Seat")," ",e]}),(0,s.jsx)("select",{disabled:!em,value:(null==Q?void 0:null===(t=Q.seatMenuId)||void 0===t?void 0:t[e])||(null===(l=X.seatMenuId)||void 0===l?void 0:l[e])||(null===(a=Y[0])||void 0===a?void 0:a.id),onChange:t=>D(b.id,e,t.target.value),className:["rounded-xl bg-black/60 border border-zinc-800 text-white px-3 py-2 text-sm outline-none w-[170px]",em?"focus:border-amber-500/80":"opacity-50 cursor-not-allowed"].join(" "),children:Y.map(e=>(0,s.jsx)("option",{value:e.id,children:e.label},e.id))})]},e)})})]}),(0,s.jsxs)("div",{className:"flex items-center justify-between gap-3",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("div",{className:"text-xs font-black text-zinc-300",children:_("WINE PAIRING","WINE PAIRING")}),(0,s.jsx)("div",{className:"text-xs text-zinc-500 mt-1",children:_("Shows “PAIRING” on KDS ticket.","Shows “PAIRING” on KDS ticket.")})]}),(0,s.jsx)("button",{disabled:!em,onClick:()=>y(b.id,!X.pairing),className:["px-4 py-2 rounded-xl font-black border transition",X.pairing?"bg-indigo-600 border-indigo-500 text-white hover:bg-indigo-500":"bg-zinc-950 border-zinc-800 text-zinc-200 hover:bg-zinc-900",em?"":"opacity-50 cursor-not-allowed"].join(" "),children:X.pairing?_("PAIRING ON","PAIRING ON"):_("NO PAIRING","NO PAIRING")})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("div",{className:"text-xs font-black text-zinc-300 mb-2",children:_("SEAT NOTES (ALLERGY / PREF) — visible in Approval + KDS","SEAT NOTES (ALLERGY / PREF) — visible in Approval + KDS")}),(0,s.jsx)("div",{className:"grid grid-cols-2 gap-3",children:Array.from({length:b.pax}).map((e,t)=>{var l,a;let n=t+1,i=null!==(a=null===(l=X.allergiesBySeat)||void 0===l?void 0:l[n])&&void 0!==a?a:"";return(0,s.jsxs)("div",{className:"rounded-xl border border-zinc-800 bg-black p-3",children:[(0,s.jsxs)("div",{className:"text-[11px] font-black text-zinc-300 mb-2",children:[_("Seat","Seat")," ",n]}),(0,s.jsx)("input",{disabled:!em,value:i,onChange:e=>w(b.id,n,e.target.value),placeholder:_("e.g. no shellfish / vegan / preference…","e.g. no shellfish / vegan / preference…"),className:["w-full rounded-lg bg-zinc-950 border border-zinc-800 text-white px-3 py-2 text-sm outline-none focus:border-amber-500",em?"":"opacity-60 cursor-not-allowed"].join(" ")})]},n)})})]})]})]}),(0,s.jsxs)("div",{className:"mt-6 grid grid-cols-2 gap-3",children:[(0,s.jsx)("button",{disabled:"NONE"!==Z,onClick:()=>f(b.id),className:["rounded-2xl font-black py-3 text-black transition","NONE"===Z?"bg-green-600 hover:bg-green-500":"bg-zinc-800 text-zinc-500 cursor-not-allowed"].join(" "),children:_("SEND TO KITCHEN","SEND TO KITCHEN")}),(0,s.jsx)("button",{onClick:()=>j(b.id,!X.paused),className:["rounded-2xl font-black py-3 border transition",X.paused?"bg-purple-600 border-purple-500 text-white hover:bg-purple-500":"bg-zinc-950 border-zinc-800 text-zinc-200 hover:bg-zinc-900"].join(" "),children:X.paused?_("RESUME","RESUME"):_("PAUSE","PAUSE")}),(0,s.jsxs)("button",{disabled:!eg,onClick:()=>E(b.id),className:["rounded-2xl font-black py-3 text-black transition col-span-2",eg?"bg-amber-500 hover:bg-amber-400":"bg-zinc-800 text-zinc-500 cursor-not-allowed"].join(" "),children:[eg?ef:_("FIRE NEXT","FIRE NEXT"),ej?(0,s.jsx)("div",{className:"text-xs font-bold mt-1",children:ej}):null]}),(0,s.jsx)("div",{className:"col-span-2 text-xs text-zinc-500",children:_("Rule: can’t fire again for 60s. Refire only while paused.","Rule: can’t fire again for 60s. Refire only while paused.")})]}),(0,s.jsxs)("div",{className:"mt-4 space-y-3",children:[(0,s.jsxs)("div",{className:"rounded-2xl border border-zinc-800 bg-zinc-950/40 overflow-hidden",children:[(0,s.jsxs)("div",{className:"px-4 py-3 border-b border-zinc-800 flex items-center justify-between",children:[(0,s.jsx)("div",{className:"text-xs font-black text-white",children:_("NOW","NOW")}),er?(0,s.jsxs)("div",{className:"text-xs text-zinc-500",children:["#",er.idx]}):null]}),(0,s.jsx)("div",{className:"p-4",children:er?(0,s.jsx)(u,{course:er,pax:b.pax,wineLabel:eb(er),extras:(null===(l=X.extrasByCourseId)||void 0===l?void 0:l[er.id])||[],onEditPairing:eo?()=>{var e,t;let l=null!==(e=eb(er))&&void 0!==e?e:"",s=null!==(t=prompt("".concat(_("Wine for course","Wine for course")," #").concat(er.idx," (").concat(er.name,")"),l))&&void 0!==t?t:"";A(b.id,er.id,s.trim())}:null}):(0,s.jsx)("div",{className:"text-sm text-zinc-500",children:_("Nothing fired yet.","Nothing fired yet.")})})]}),(0,s.jsxs)("div",{className:"rounded-2xl border border-zinc-800 bg-zinc-950/40 overflow-hidden",children:[(0,s.jsxs)("div",{className:"px-4 py-3 border-b border-zinc-800 flex items-center justify-between",children:[(0,s.jsx)("div",{className:"text-xs font-black text-white",children:_("NEXT","NEXT")}),(0,s.jsxs)("div",{className:"text-xs text-zinc-500",children:[ed.length," ",_("items","items")]})]}),(0,s.jsxs)("div",{className:"p-4 space-y-2",children:[ed.map(e=>{var t;return(0,s.jsx)("div",{className:"rounded-xl border border-zinc-800 bg-black/40 p-3",children:(0,s.jsx)(u,{course:e,pax:b.pax,wineLabel:eb(e),extras:(null===(t=X.extrasByCourseId)||void 0===t?void 0:t[e.id])||[],onEditPairing:eo?()=>{var t,l;let s=null!==(t=eb(e))&&void 0!==t?t:"",a=null!==(l=prompt("".concat(_("Wine for course","Wine for course")," #").concat(e.idx," (").concat(e.name,")"),s))&&void 0!==l?l:"";A(b.id,e.id,a.trim())}:null})},e.id)}),ed.length?null:(0,s.jsx)("div",{className:"text-sm text-zinc-500",children:_("No pending courses.","No pending courses.")})]})]}),(0,s.jsxs)("div",{className:"rounded-2xl border border-zinc-800 bg-zinc-950/40 overflow-hidden",children:[(0,s.jsxs)("button",{onClick:()=>g(e=>!e),className:"w-full px-4 py-3 border-b border-zinc-800 flex items-center justify-between text-left",children:[(0,s.jsx)("div",{className:"text-xs font-black text-white",children:_("FULL MENU","FULL MENU")}),(0,s.jsx)("div",{className:"text-xs font-black text-amber-300",children:N?_("HIDE","HIDE"):_("SHOW","SHOW")})]}),N?(0,s.jsx)("div",{ref:J,className:"max-h-[420px] overflow-y-auto p-4 space-y-2",children:en.map(e=>{var t;return(0,s.jsx)("div",{ref:"FIRED"===e.status?$:void 0,className:["rounded-xl border p-3","FIRED"===e.status?"border-amber-500/60 bg-amber-500/10":"border-zinc-800 bg-black/30"].join(" "),children:(0,s.jsx)(u,{course:e,pax:b.pax,wineLabel:eb(e),extras:(null===(t=X.extrasByCourseId)||void 0===t?void 0:t[e.id])||[],onEditPairing:eo?()=>{var t,l;let s=null!==(t=eb(e))&&void 0!==t?t:"",a=null!==(l=prompt("".concat(_("Wine for course","Wine for course")," #").concat(e.idx," (").concat(e.name,")"),s))&&void 0!==l?l:"";A(b.id,e.id,a.trim())}:null})},e.id)})}):null]})]})]}):null]})}function u(e){let{course:t,pax:l,wineLabel:a,extras:n,onEditPairing:i}=e,{t:r}=(0,o.Q)(),d=t.name,c=t.seatDish||{},x=new Set(Object.entries(t.seatSubs||{}).filter(e=>{let[,t]=e;return(t||"").trim().length>0}).map(e=>{let[t]=e;return Number(t)})),b=Object.entries(c).map(e=>{let[t,l]=e;return{seat:Number(t),dish:l||""}}).filter(e=>e.dish).filter(e=>e.dish!==d&&!x.has(e.seat)),{baseCount:u,subSeatLines:m}=function(e,t){let l=Object.entries(e.seatSubs||{}).map(e=>{let[t,l]=e;return{seat:Number(t),sub:(l||"").trim()}}).filter(e=>e.sub.length>0).sort((e,t)=>e.seat-t.seat);return{baseCount:Math.max(0,t-l.length),subSeatLines:l.map(e=>({key:"S".concat(e.seat,"_").concat(e.sub),seat:e.seat,sub:e.sub}))}}(t,l);return(0,s.jsxs)("div",{children:[(0,s.jsxs)("div",{className:"flex items-center justify-between gap-3",children:[(0,s.jsxs)("div",{className:"text-white font-black",children:[(0,s.jsxs)("span",{className:"text-zinc-400 font-mono text-xs",children:["#",t.idx]})," ",d," ",u>0?(0,s.jsxs)("span",{className:"text-zinc-400 font-black",children:[u,"x"]}):null]}),(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[a?i?(0,s.jsx)("button",{onClick:i,className:"text-xs font-black text-indigo-200 px-2 py-1 rounded-lg border border-indigo-700 bg-indigo-900/20 hover:bg-indigo-900/35 transition",title:r("Tap to change wine (FOH only)","Tap to change wine (FOH only)"),children:a}):(0,s.jsx)("div",{className:"text-xs font-black text-indigo-200 px-2 py-1 rounded-lg border border-indigo-700 bg-indigo-900/20",children:a}):null,(0,s.jsx)("div",{className:"text-xs font-black px-2 py-1 rounded-lg border border-zinc-800 bg-black/40 text-zinc-200",children:r(t.status,t.status)})]})]}),b.length>0?(0,s.jsx)("div",{className:"mt-2 text-xs text-zinc-300 space-y-1",children:b.map(e=>(0,s.jsxs)("div",{children:[(0,s.jsxs)("span",{className:"font-black text-zinc-200",children:[r("Seat","Seat")," ",e.seat,":"]})," ",e.dish]},e.seat))}):null,m.length>0&&(0,s.jsx)("div",{className:"mt-2 text-[11px] text-zinc-300 space-y-0.5",children:m.map(e=>(0,s.jsxs)("div",{children:[r("Seat","Seat")," ",e.seat," — ",e.sub," 1x"]},e.key))}),n.length>0?(0,s.jsx)("div",{className:"mt-2 text-[11px] text-zinc-200 space-y-0.5",children:n.map((e,t)=>(0,s.jsxs)("div",{children:[(0,s.jsxs)("span",{className:"font-black",children:[r("EXTRA","EXTRA"),":"]})," ",e]},"".concat(e,"_").concat(t)))}):null]})}}},function(e){e.O(0,[459,310,376,971,23,744],function(){return e(e.s=7670)}),_N_E=e.O()}]);