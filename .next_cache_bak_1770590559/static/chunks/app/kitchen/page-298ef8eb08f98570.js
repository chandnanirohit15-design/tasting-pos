(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[54],{3381:function(e,t,s){Promise.resolve().then(s.bind(s,7832))},7832:function(e,t,s){"use strict";s.r(t),s.d(t,{default:function(){return u}});var n=s(7437),r=s(2265),i=s(6463),l=s(4774),a=s(4310),d=s(7188),o=s(5376),c=s(1459);function x(e){let{pax:t,setup:s,presets:i,dishPresets:l,menus:a,onSetSeatMenu:d,onSetSeatSub:x,onAddExtraDish:u,onRemoveExtraDish:b,onSetChefNote:m,onInsertCourseLine:p,onDeleteCourseLine:v,onMoveCourseLine:h}=e,{t:f}=(0,c.Q)(),[N,g]=r.useState(null),j=(0,o.gm)(s.allergiesBySeat);return(0,n.jsxs)("div",{className:"space-y-4",children:[(0,n.jsxs)("div",{className:"rounded-xl border border-zinc-800 bg-black p-4",children:[(0,n.jsx)("div",{className:"text-xs font-black text-zinc-200 mb-2",children:f("SEAT NOTES (ALLERGY / PREF)","SEAT NOTES (ALLERGY / PREF)")}),0===j.length?(0,n.jsx)("div",{className:"text-sm text-zinc-500",children:"—"}):(0,n.jsx)("div",{className:"grid grid-cols-2 gap-3",children:Array.from({length:t}).map((e,t)=>{var r,i;let l=t+1,a=(null!==(i=null===(r=s.allergiesBySeat)||void 0===r?void 0:r[l])&&void 0!==i?i:"").trim();return(0,n.jsxs)("div",{className:"rounded-lg border border-zinc-800 bg-zinc-950 p-3",children:[(0,n.jsxs)("div",{className:"text-[11px] font-black text-zinc-300 mb-1",children:[f("Seat","Seat")," ",l]}),(0,n.jsx)("div",{className:a?"text-sm text-white font-black":"text-sm text-zinc-500",children:a||"—"})]},l)})})]}),(0,n.jsxs)("div",{className:"rounded-xl border border-zinc-800 bg-black p-4",children:[(0,n.jsx)("div",{className:"text-xs font-black text-zinc-200 mb-2",children:f("CHEF NOTE (VISIBLE TO FOH + KITCHEN)","CHEF NOTE (VISIBLE TO FOH + KITCHEN)")}),(0,n.jsx)("textarea",{value:s.chefNote||"",onChange:e=>m(e.target.value),placeholder:f("Pacing / VIP / hold after course 6 / etc…","Pacing / VIP / hold after course 6 / etc…"),className:"w-full min-h-[70px] rounded-xl bg-zinc-950 border border-zinc-800 text-white px-3 py-2 text-sm outline-none focus:border-amber-500"})]}),a&&a.length>0&&d?(0,n.jsxs)("div",{className:"rounded-xl border border-zinc-800 bg-black p-4",children:[(0,n.jsx)("div",{className:"text-xs font-black text-zinc-200 mb-2",children:f("MENU PER SEAT","MENU PER SEAT")}),(0,n.jsx)("div",{className:"grid grid-cols-2 gap-3",children:Array.from({length:t}).map((e,t)=>{var r,i;let l=t+1,o=(null===(r=s.seatMenuId)||void 0===r?void 0:r[l])||(null===(i=a[0])||void 0===i?void 0:i.id);return(0,n.jsxs)("div",{className:"rounded-lg border border-zinc-800 bg-zinc-950 p-3",children:[(0,n.jsxs)("div",{className:"text-[11px] font-black text-zinc-300 mb-2",children:[f("Seat","Seat")," ",l]}),(0,n.jsx)("select",{value:o,onChange:e=>d(l,e.target.value),className:"w-full rounded-lg bg-zinc-950 border border-zinc-800 text-white px-3 py-2 text-sm outline-none focus:border-amber-500",children:a.map(e=>(0,n.jsx)("option",{value:e.id,children:e.label},e.id))})]},l)})})]}):null,(0,n.jsxs)("div",{className:"rounded-2xl border border-zinc-800 bg-zinc-900/40 overflow-hidden",children:[(0,n.jsxs)("div",{className:"px-4 py-3 border-b border-zinc-800 bg-zinc-950 flex items-center justify-between",children:[(0,n.jsx)("div",{className:"text-sm font-black text-white",children:f("SUBSTITUTIONS PER SEAT","SUBSTITUTIONS PER SEAT")}),(0,n.jsx)("div",{className:"text-xs text-zinc-500",children:f("Tap a course → choose substitute per seat","Tap a course → choose substitute per seat")})]}),(0,n.jsx)("div",{className:"divide-y divide-zinc-800",children:s.courseLines.map(e=>{var r;return(0,n.jsxs)("div",{className:"p-4",children:[(0,n.jsxs)("button",{onClick:()=>g(t=>t===e.id?null:e.id),className:"w-full text-left flex items-start justify-between gap-3",children:[(0,n.jsxs)("div",{children:[(()=>{let s=(0,o.Di)(e,t);return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsxs)("div",{className:"text-white font-black",children:[(0,n.jsxs)("span",{className:"text-zinc-400 font-mono text-xs",children:["#",e.idx]})," ",s.baseCount,"x ",s.baseDish]}),s.exceptions.length>0?(0,n.jsx)("div",{className:"mt-1 text-xs text-zinc-400 space-y-1",children:s.exceptions.map(e=>(0,n.jsxs)("div",{children:[(0,n.jsxs)("span",{className:"font-black text-zinc-300",children:[f("Seat","Seat")," ",e.seat," →"]})," ",e.dish]},e.seat))}):null]})})(),(0,n.jsx)("div",{className:"text-xs text-zinc-500 mt-1",children:Object.values(e.seatSubs||{}).some(e=>(e||"").trim().length>0)?f("Substitutions set","Substitutions set"):f("No substitutions","No substitutions")})]}),(0,n.jsx)("div",{className:"text-xs font-black text-zinc-300",children:N===e.id?f("CLOSE","CLOSE"):f("EDIT","EDIT")})]}),N===e.id&&(0,n.jsxs)("div",{children:[(0,n.jsx)("div",{className:"mt-4 grid grid-cols-2 gap-3",children:Array.from({length:t}).map((t,s)=>{var r,l;let a=s+1,d=null!==(l=null===(r=e.seatSubs)||void 0===r?void 0:r[a])&&void 0!==l?l:"";return(0,n.jsxs)("div",{className:"rounded-xl border border-zinc-800 bg-black p-3",children:[(0,n.jsxs)("div",{className:"text-[11px] font-black text-zinc-300 mb-2",children:[f("Seat","Seat")," ",a]}),(0,n.jsxs)("select",{value:d,onChange:t=>x(e.id,a,t.target.value),className:"w-full rounded-lg bg-zinc-950 border border-zinc-800 text-white px-3 py-2 text-sm outline-none focus:border-amber-500",children:[(0,n.jsx)("option",{value:"",children:f("— No substitution —","— No substitution —")}),i.map(e=>(0,n.jsx)("option",{value:e,children:e},e))]})]},a)})}),(0,n.jsxs)("div",{className:"mt-4 rounded-xl border border-zinc-800 bg-black p-3",children:[(0,n.jsxs)("div",{className:"flex items-center justify-between gap-2",children:[(0,n.jsx)("div",{className:"text-[11px] font-black text-zinc-300",children:f("EXTRA DISHES (THIS COURSE)","EXTRA DISHES (THIS COURSE)")}),(0,n.jsxs)("select",{defaultValue:"",onChange:t=>{let s=t.target.value;if(s){if("__custom__"===s){var n;let s=(null===(n=prompt("Extra dish name?"))||void 0===n?void 0:n.trim())||"";s&&u(e.id,s),t.currentTarget.value="";return}u(e.id,s),t.currentTarget.value=""}},className:"rounded-lg bg-zinc-950 border border-zinc-800 text-white px-3 py-2 text-sm outline-none focus:border-amber-500",children:[(0,n.jsx)("option",{value:"",children:f("+ Add dish…","+ Add dish…")}),l.map(e=>(0,n.jsx)("option",{value:e,children:e},e)),(0,n.jsx)("option",{value:"__custom__",children:f("Custom…","Custom…")})]})]}),(0,n.jsx)("div",{className:"mt-2 space-y-2",children:((null===(r=s.extrasByCourseId)||void 0===r?void 0:r[e.id])||[]).map((t,s)=>(0,n.jsxs)("div",{className:"flex items-center justify-between gap-2 rounded-lg border border-zinc-800 bg-zinc-950 p-2",children:[(0,n.jsx)("div",{className:"text-sm text-white font-black truncate",children:t}),(0,n.jsx)("button",{onClick:()=>b(e.id,s),className:"px-3 py-1.5 rounded-lg border border-zinc-700 bg-black/40 text-xs font-black text-zinc-200 hover:bg-zinc-900/40",children:f("DELETE","DELETE")})]},"".concat(t,"_").concat(s)))})]}),(0,n.jsxs)("div",{className:"mt-3 flex flex-wrap gap-2",children:[(0,n.jsx)("button",{className:"px-3 py-2 rounded-xl text-xs font-black border border-zinc-700 bg-black/40 text-zinc-200 hover:bg-zinc-900/40",onClick:()=>{var t;let s=(null===(t=prompt("Course name?"))||void 0===t?void 0:t.trim())||"";s&&p(e.id,"BEFORE",s)},children:f("+ ADD BEFORE","+ ADD BEFORE")}),(0,n.jsx)("button",{className:"px-3 py-2 rounded-xl text-xs font-black border border-zinc-700 bg-black/40 text-zinc-200 hover:bg-zinc-900/40",onClick:()=>{var t;let s=(null===(t=prompt("Course name?"))||void 0===t?void 0:t.trim())||"";s&&p(e.id,"AFTER",s)},children:f("+ ADD AFTER","+ ADD AFTER")}),(0,n.jsx)("button",{className:"px-3 py-2 rounded-xl text-xs font-black border border-zinc-700 bg-black/40 text-zinc-200 hover:bg-zinc-900/40",onClick:()=>h(e.id,-1),children:f("↑ MOVE","↑ MOVE")}),(0,n.jsx)("button",{className:"px-3 py-2 rounded-xl text-xs font-black border border-zinc-700 bg-black/40 text-zinc-200 hover:bg-zinc-900/40",onClick:()=>h(e.id,1),children:f("↓ MOVE","↓ MOVE")}),(0,n.jsx)("button",{className:"px-3 py-2 rounded-xl text-xs font-black border border-red-700 bg-red-900/20 text-red-200 hover:bg-red-900/30",onClick:()=>v(e.id),children:f("DELETE COURSE","DELETE COURSE")})]})]})]},e.id)})})]})]})}function u(){var e;let t=(0,i.useRouter)(),{t:s}=(0,c.Q)(),{kitchenAuthed:u,setRole:v}=(0,l.q)(),{tables:h,reservations:f,approveTable:N,setSeatSub:g,coursePresetSubs:j,dishPresets:E,addExtraDish:z,removeExtraDish:S,setChefNote:k,insertCourseLine:D,deleteCourseLine:A,moveCourseLine:T,setSeatMenu:R,draftMoveCourse:I,draftDeleteCourse:y,draftInsertCourse:w,draftSetSeatSub:C,draftAddExtraDish:P,draftRemoveExtraDish:L,draftSetChefNote:M,markDone:O}=(0,a.mr)();r.useEffect(()=>{v("KITCHEN"),u||t.replace("/kitchen/login")},[u,t,v]);let[K,F]=r.useState(()=>Date.now());r.useEffect(()=>{let e=setInterval(()=>F(Date.now()),3e4);return()=>clearInterval(e)},[]);let[V,G]=r.useState("KDS"),U=r.useMemo(()=>(0,d.ri)().menus||[],[]),[_,B]=r.useState({}),[H,W]=r.useState(null),[Y,Q]=r.useState(null),[q,X]=r.useState(null),[J,Z]=r.useState(null),$=r.useMemo(()=>new Map(f.map(e=>[String(e.id),e])),[f]),ee=r.useMemo(()=>q&&h.find(e=>e.id===q)||null,[q,h]),et=r.useMemo(()=>h.filter(e=>{var t,s;return"SEATED"===e.status&&(null!==(s=null===(t=e.setup)||void 0===t?void 0:t.approval)&&void 0!==s?s:"NONE")==="PENDING"}).sort((e,t)=>(0,o.Ri)(e.name)-(0,o.Ri)(t.name)),[h]),es=r.useMemo(()=>h.filter(e=>{var t,s;return"SEATED"===e.status&&(null!==(s=null===(t=e.setup)||void 0===t?void 0:t.approval)&&void 0!==s?s:"NONE")==="APPROVED"&&e.setup}).sort((e,t)=>{var s,n;let r=!!(null===(s=e.setup)||void 0===s?void 0:s.paused);if(!!(null===(n=t.setup)||void 0===n?void 0:n.paused)!==r)return r?-1:1;let i=(0,o.LF)(e.setup),l=(0,o.LF)(t.setup),a=null!==i,d=null!==l;return a!==d?a?-1:1:a&&d&&i!==l?i-l:(0,o.Ri)(e.name)-(0,o.Ri)(t.name)}),[h]),en=r.useMemo(()=>f.filter(e=>("DRAFT"===e.draftStatus||"PREPPED"===e.draftStatus)&&!!e.draftSetup&&!e.sentToApproval),[f]),er=r.useMemo(()=>Y&&f.find(e=>e.id===Y)||null,[Y,f]),ei=r.useMemo(()=>(null==er?void 0:er.draftSetup)?{id:-1,name:er.tablePref||s("DRAFT","DRAFT"),pax:er.pax,status:"SEATED",x:0,y:0,reservationName:er.name,reservationPax:er.pax,reservationTime:er.time,language:er.language,setup:er.draftSetup}:null,[er,s]),el=r.useCallback(e=>{var t,s;return(null!==(s=null===(t=e.setup)||void 0===t?void 0:t.courseLines)&&void 0!==s?s:[]).reduce((e,t)=>{var s;return e+(null!==(s=t.refireCount)&&void 0!==s?s:0)},0)},[]),ea=r.useCallback(e=>{var t;if(!(null===(t=e.setup)||void 0===t?void 0:t.paused))return!1;let s=el(e),n=_[e.id];return void 0===n||s>n},[_,el]),ed=r.useCallback(e=>{let t=el(e);B(s=>({...s,[e.id]:t}))},[el]);r.useEffect(()=>{B(e=>{let t=!1,s={...e};for(let e of h){var n;(null===(n=e.setup)||void 0===n?void 0:n.paused)||void 0===s[e.id]||(delete s[e.id],t=!0)}return t?s:e})},[h]);let eo=r.useMemo(()=>et.find(e=>e.id===H)||null,[et,H]);return(r.useEffect(()=>{et.length>0&&null===H&&W(et[0].id),0===et.length&&W(null)},[et,H]),u)?(0,n.jsxs)(n.Fragment,{children:[(0,n.jsxs)("div",{className:"h-full w-full bg-zinc-950 flex flex-col",children:[(0,n.jsxs)("div",{className:"h-14 border-b border-zinc-800 bg-black flex items-center justify-between px-6",children:[(0,n.jsxs)("div",{className:"flex items-center gap-3",children:[(0,n.jsx)("div",{className:"text-white font-black tracking-tight",children:s("KITCHEN","KITCHEN")}),(0,n.jsx)("div",{className:"text-xs text-zinc-500",children:s("Approval + KDS Rail","Approval + KDS Rail")})]}),(0,n.jsxs)("div",{className:"flex gap-2",children:[(0,n.jsxs)("button",{onClick:()=>G("DRAFT"),className:["px-3 py-1.5 rounded-md text-xs font-black border transition","DRAFT"===V?"bg-amber-500 text-black border-amber-400":"bg-zinc-900 text-zinc-300 border-zinc-800 hover:bg-zinc-800"].join(" "),children:[s("DRAFT","DRAFT")," (",en.length,")"]}),(0,n.jsxs)("button",{onClick:()=>G("KDS"),className:["px-3 py-1.5 rounded-md text-xs font-black border transition","KDS"===V?"bg-amber-500 text-black border-amber-400":"bg-zinc-900 text-zinc-300 border-zinc-800 hover:bg-zinc-800"].join(" "),children:[s("KDS","KDS")," (",es.length,")"]}),(0,n.jsxs)("button",{onClick:()=>G("APPROVAL"),className:["px-3 py-1.5 rounded-md text-xs font-black border transition","APPROVAL"===V?"bg-amber-500 text-black border-amber-400":"bg-zinc-900 text-zinc-300 border-zinc-800 hover:bg-zinc-800"].join(" "),children:[s("APPROVAL","APPROVAL")," (",et.length,")"]})]})]}),"DRAFT"===V?(0,n.jsx)(m,{reservations:en,onEditDraft:e=>Z(String(e))}):"KDS"===V?(0,n.jsx)(b,{tables:es,markDone:O,now:K,needsPauseAttention:ea,onAcknowledgePause:ed,reservationById:$,onEditKdsTable:e=>X(e)}):(0,n.jsxs)("div",{className:"grid grid-cols-[320px_1fr_420px] gap-4 h-full p-4 overflow-hidden",children:[(0,n.jsxs)("div",{className:"h-full overflow-y-auto",children:[(0,n.jsxs)("div",{className:"flex items-center justify-between mb-2",children:[(0,n.jsx)("div",{className:"text-sm font-black text-zinc-200",children:s("PENDING APPROVAL","PENDING APPROVAL")}),(0,n.jsx)("div",{className:"text-xs text-zinc-500",children:et.length})]}),0===et.length?(0,n.jsx)("div",{className:"text-sm text-zinc-500 border border-dashed border-zinc-800 rounded-xl p-4",children:s("No tables waiting for approval.","No tables waiting for approval.")}):(0,n.jsx)("div",{className:"space-y-2",children:et.map(e=>{var t,r,i,l,a;let c=e.id===H,x=(0,o.W3)(null===(t=e.setup)||void 0===t?void 0:t.allergiesBySeat),u=!!(null===(r=e.setup)||void 0===r?void 0:r.paused);return(0,n.jsxs)("button",{onClick:()=>{W(e.id),Q(null)},className:["w-full text-left rounded-xl border p-3 transition",c?"border-amber-500 bg-amber-900/15":"border-zinc-800 bg-zinc-900/40 hover:bg-zinc-900/70"].join(" "),children:[(0,n.jsxs)("div",{className:"flex items-start justify-between",children:[(0,n.jsxs)("div",{children:[(0,n.jsx)("div",{className:"text-white font-black text-lg",children:e.name}),(0,n.jsxs)("div",{className:"text-xs text-zinc-400 mt-0.5",children:[e.reservationName," • ",e.pax," ",s("pax","pax")," • ",e.language]})]}),(0,n.jsxs)("div",{className:"flex flex-col items-end gap-2",children:[(0,n.jsx)("span",{className:"text-[10px] font-black px-2 py-1 rounded border border-amber-600 bg-amber-900/30 text-amber-200",children:s("PENDING","PENDING")}),(null===(i=e.setup)||void 0===i?void 0:i.pairing)&&(0,n.jsx)("span",{className:"text-[10px] font-black px-2 py-1 rounded border border-indigo-600 bg-indigo-900/25 text-indigo-200",children:s("PAIRING","PAIRING")}),x&&(0,n.jsx)("span",{className:"text-[10px] font-black px-2 py-1 rounded border border-red-600 bg-red-900/25 text-red-200",children:s("ALLERGY","ALLERGY")}),u&&(0,n.jsx)("span",{className:"text-[10px] font-black px-2 py-1 rounded border border-zinc-600 bg-zinc-900/40 text-zinc-200",children:s("PAUSED","PAUSED")})]})]}),(0,n.jsx)("div",{className:"mt-2 flex gap-2 items-center text-[10px] text-zinc-300",children:(0,n.jsxs)("span",{className:"px-2 py-0.5 rounded border border-zinc-700 bg-zinc-900",children:[s("MENU","MENU")," ",(null===(l=(0,d.F)((null===(a=e.setup)||void 0===a?void 0:a.menuId)||""))||void 0===l?void 0:l.label)||s("Menu","Menu")]})})]},e.id)})})]}),(0,n.jsxs)("div",{className:"h-full overflow-y-auto",children:[(0,n.jsx)("div",{className:"text-2xl font-black text-white",children:s("Approval","Approval")}),(0,n.jsx)("div",{className:"text-zinc-400 mt-1",children:s("Seat substitutions. Seat notes are visible here and on the KDS ticket.","Seat substitutions. Seat notes are visible here and on the KDS ticket.")}),eo&&eo.setup?(0,n.jsx)(p,{table:eo,presets:j,dishPresets:E,menus:U,onSetSeatMenu:R,onSetSeatSub:g,onAddExtraDish:z,onRemoveExtraDish:S,onSetChefNote:k,onInsertChefSpecial:D,onDeleteCourseLine:A,onMoveCourseLine:T,onApprove:()=>N(eo.id)}):(0,n.jsx)("div",{className:"mt-8 rounded-2xl border border-zinc-800 bg-zinc-900/40 p-6 text-zinc-500",children:s("Select a pending table.","Select a pending table.")})]}),(0,n.jsx)("div",{className:"h-full overflow-y-auto",children:(0,n.jsxs)("div",{className:"rounded-2xl border border-zinc-800 bg-zinc-950/40 p-3",children:[(0,n.jsxs)("div",{className:"flex items-center justify-between mb-3",children:[(0,n.jsx)("div",{className:"text-xs font-black text-zinc-200",children:s("LIVE PREVIEW","LIVE PREVIEW")}),(0,n.jsx)("div",{className:"text-[10px] font-black text-zinc-500",children:s("KDS ticket","KDS ticket")})]}),er&&ei?(0,n.jsx)("div",{className:"rounded-2xl border border-zinc-800 bg-black/30 p-2",children:(0,n.jsx)(o.wx,{table:ei,mode:"PREVIEW",labelMode:"draft",guestSubs:er.draftGuestSubs||[],guestSeatMap:er.draftGuestSeatMap||void 0})}):eo?(0,n.jsx)("div",{className:"rounded-2xl border border-zinc-800 bg-black/30 p-2",children:(0,n.jsx)(o.wx,{table:eo,mode:"PREVIEW",labelMode:"approval",guestSeatMap:eo.reservationId?null===(e=$.get(String(eo.reservationId)))||void 0===e?void 0:e.draftGuestSeatMap:void 0})}):(0,n.jsx)("div",{className:"text-sm text-zinc-500",children:s("Select a table or draft ticket.","Select a table or draft ticket.")})]})})]})]}),ee?(0,n.jsx)("div",{className:"fixed inset-0 z-50 bg-black/70 backdrop-blur-sm flex items-end md:items-center justify-center p-4",onClick:()=>X(null),children:(0,n.jsxs)("div",{className:"w-full max-w-3xl max-h-[92vh] rounded-2xl border border-zinc-800 bg-[#0f0f12] overflow-hidden flex flex-col",onClick:e=>e.stopPropagation(),children:[(0,n.jsxs)("div",{className:"px-4 py-3 border-b border-zinc-800 flex items-center justify-between sticky top-0 bg-[#0f0f12] z-10",children:[(0,n.jsxs)("div",{className:"text-sm font-black text-white",children:[s("KDS EDIT","KDS EDIT")," — ",ee.name]}),(0,n.jsx)("button",{onClick:()=>X(null),className:"px-3 py-2 rounded-xl text-xs font-black border border-zinc-800 bg-black/35 text-zinc-200 hover:bg-zinc-900/40",children:s("DONE","DONE")})]}),(0,n.jsx)("div",{className:"p-4 overflow-y-auto min-h-0",children:(0,n.jsx)(x,{pax:ee.pax,setup:ee.setup,presets:j,dishPresets:E,menus:U,onSetSeatMenu:(e,t)=>R(ee.id,e,t),onSetSeatSub:(e,t,s)=>g(ee.id,e,t,s),onAddExtraDish:(e,t)=>z(ee.id,e,t),onRemoveExtraDish:(e,t)=>S(ee.id,e,t),onSetChefNote:e=>k(ee.id,e),onInsertCourseLine:(e,t,s)=>D(ee.id,e,t,s),onDeleteCourseLine:e=>A(ee.id,e),onMoveCourseLine:(e,t)=>T(ee.id,e,t)})})]})}):null,J?(0,n.jsx)("div",{className:"fixed inset-0 z-50 bg-black/70 backdrop-blur-sm flex items-end md:items-center justify-center p-4",onClick:()=>Z(null),children:(0,n.jsxs)("div",{className:"w-full max-w-3xl max-h-[92vh] rounded-2xl border border-zinc-800 bg-[#0f0f12] overflow-hidden flex flex-col",onClick:e=>e.stopPropagation(),children:[(0,n.jsxs)("div",{className:"px-4 py-3 border-b border-zinc-800 flex items-center justify-between sticky top-0 bg-[#0f0f12] z-10",children:[(0,n.jsxs)("div",{className:"text-sm font-black text-white",children:[s("DRAFT","DRAFT")," ",s("EDIT","EDIT")]}),(0,n.jsx)("button",{onClick:()=>Z(null),className:"px-3 py-2 rounded-xl text-xs font-black border border-zinc-800 bg-black/35 text-zinc-200 hover:bg-zinc-900/40",children:s("DONE","DONE")})]}),(0,n.jsx)("div",{className:"p-4 overflow-y-auto min-h-0",children:(()=>{let e=f.find(e=>String(e.id)===String(J));return(null==e?void 0:e.draftSetup)?(0,n.jsx)(x,{pax:e.pax,setup:e.draftSetup,presets:j,dishPresets:E,onSetSeatSub:(t,s,n)=>C(e.id,t,s,n),onAddExtraDish:(t,s)=>P(e.id,t,s),onRemoveExtraDish:(t,s)=>L(e.id,t,s),onSetChefNote:t=>M(e.id,t),onInsertCourseLine:(t,s,n)=>w(e.id,t,s,n),onDeleteCourseLine:t=>y(e.id,t),onMoveCourseLine:(t,s)=>I(e.id,t,s)}):(0,n.jsx)("div",{className:"text-sm text-zinc-500",children:s("No draft tickets.","No draft tickets.")})})()})]})}):null]}):null}function b(e){let{tables:t,markDone:s,now:i,needsPauseAttention:l,onAcknowledgePause:a,reservationById:d,onEditKdsTable:x}=e,{t:u}=(0,c.Q)(),b=r.useRef({}),m=r.useMemo(()=>t.filter(e=>l(e)),[t,l]),p=r.useMemo(()=>{let e=[...t];return e.sort((e,t)=>{let s=l(e)?0:1,n=l(t)?0:1;return s!==n?s-n:(0,o.Ri)(e.name)-(0,o.Ri)(t.name)}),e},[t,l]);return(0,n.jsxs)("div",{className:"flex-1 overflow-hidden bg-zinc-900",children:[(0,n.jsxs)("div",{className:"h-12 border-b border-zinc-800 bg-zinc-950 flex items-center px-6",children:[(0,n.jsx)("div",{className:"text-sm font-black text-white",children:u("KDS RAIL","KDS RAIL")}),(0,n.jsx)("div",{className:"ml-3 text-xs text-zinc-400",children:u("White tickets • full menu • pairing/allergy/paused on top • fired time + refire count","White tickets • full menu • pairing/allergy/paused on top • fired time + refire count")})]}),(0,n.jsxs)("div",{className:"border-b border-zinc-800 bg-black px-6 py-3",children:[(0,n.jsx)("div",{className:"text-[11px] font-black text-zinc-300 tracking-widest",children:u("ACTION RAIL","ACTION RAIL")}),0===m.length?(0,n.jsx)("div",{className:"mt-2 text-xs text-zinc-500",children:u("No paused tables need attention.","No paused tables need attention.")}):(0,n.jsx)("div",{className:"mt-2 flex gap-2 flex-wrap",children:m.map(e=>(0,n.jsxs)("button",{onClick:()=>{let t=b.current[e.id];t&&t.scrollIntoView({behavior:"smooth",inline:"start",block:"nearest"})},className:"px-3 py-2 rounded-xl border border-zinc-700 bg-zinc-900/50 text-zinc-100 text-xs font-black",children:[e.name," • ",u("PAUSED","PAUSED")]},e.id))})]}),(0,n.jsx)("div",{className:"h-full overflow-x-auto overflow-y-hidden",children:(0,n.jsx)("div",{className:"flex gap-4 p-4 min-w-max",children:0===p.length?(0,n.jsx)("div",{className:"text-zinc-500 border border-dashed border-zinc-700 rounded-2xl p-6 bg-black/30",children:u("No approved tables yet.","No approved tables yet.")}):p.map(e=>{var t;return(0,n.jsxs)("div",{ref:t=>{b.current[e.id]=t},className:"w-[360px] shrink-0",children:[(0,n.jsx)("div",{className:"mb-2 text-xs font-black text-zinc-300",children:u("KDS TICKET","KDS TICKET")}),(0,n.jsx)(o.wx,{table:e,markDone:s,now:i,pauseNeedsAttention:l(e),onAcknowledgePause:()=>a(e),mode:"KDS",editMode:!1,onToggleEdit:()=>x(e.id),labelMode:"approval",guestSeatMap:e.reservationId?null===(t=d.get(String(e.reservationId)))||void 0===t?void 0:t.draftGuestSeatMap:void 0})]},e.id)})})})]})}function m(e){let{reservations:t,onEditDraft:s}=e,{t:i}=(0,c.Q)(),l=r.useMemo(()=>t.filter(e=>e.draftSetup).map(e=>({id:-1,name:e.tablePref||i("DRAFT","DRAFT"),pax:e.pax,status:"SEATED",x:0,y:0,reservationName:e.name,reservationPax:e.pax,reservationTime:e.time,language:e.language,setup:e.draftSetup,reservationId:e.id})),[t,i]);return(0,n.jsxs)("div",{className:"flex-1 overflow-hidden bg-zinc-900",children:[(0,n.jsxs)("div",{className:"h-12 border-b border-zinc-800 bg-zinc-950 flex items-center px-6",children:[(0,n.jsx)("div",{className:"text-sm font-black text-white",children:i("DRAFT TICKETS","DRAFT TICKETS")}),(0,n.jsx)("div",{className:"ml-3 text-xs text-zinc-400",children:l.length})]}),(0,n.jsx)("div",{className:"h-full overflow-x-auto overflow-y-hidden",children:(0,n.jsx)("div",{className:"flex gap-4 p-4 min-w-max",children:0===l.length?(0,n.jsx)("div",{className:"text-zinc-500 border border-dashed border-zinc-700 rounded-2xl p-6 bg-black/30",children:i("No draft tickets.","No draft tickets.")}):l.map(e=>{let t=e.reservationId;return(0,n.jsxs)("div",{className:"w-[360px] shrink-0",children:[(0,n.jsx)("div",{className:"mb-2 text-xs font-black text-zinc-300",children:i("KDS TICKET","KDS TICKET")}),(0,n.jsx)(o.wx,{table:e,mode:"PREVIEW",editMode:!1,onToggleEdit:()=>s(t),labelMode:"draft"})]},t)})})})]})}function p(e){var t;let{table:s,presets:r,dishPresets:i,menus:l,onSetSeatMenu:a,onSetSeatSub:u,onAddExtraDish:b,onRemoveExtraDish:m,onSetChefNote:p,onInsertChefSpecial:v,onDeleteCourseLine:h,onMoveCourseLine:f,onApprove:N}=e,{t:g}=(0,c.Q)(),j=s.setup,E=(0,o.W3)(j.allergiesBySeat),z=!!j.paused;return(0,n.jsxs)("div",{className:"mt-6 space-y-4",children:[(0,n.jsx)("div",{className:"rounded-2xl border border-zinc-800 bg-zinc-900/40 p-4",children:(0,n.jsxs)("div",{className:"flex flex-wrap gap-2 items-center",children:[(0,n.jsx)("span",{className:"px-3 py-1 rounded border border-zinc-700 bg-zinc-950 text-sm font-black text-zinc-200",children:s.name}),s.tableLanguage?(0,n.jsx)("div",{className:"ml-2 px-2 py-1 rounded-lg border border-zinc-800 bg-black/40 text-[10px] font-black text-zinc-200",children:s.tableLanguage}):null,(0,n.jsxs)("span",{className:"px-3 py-1 rounded border border-zinc-700 bg-zinc-950 text-sm font-black text-zinc-200",children:[g("MENU","MENU")," ",(null===(t=(0,d.F)(j.menuId))||void 0===t?void 0:t.label)||g("Menu","Menu")]}),j.pairing&&(0,n.jsx)("span",{className:"px-3 py-1 rounded border border-indigo-600 bg-indigo-900/25 text-sm font-black text-indigo-200",children:g("PAIRING","PAIRING")}),E&&(0,n.jsx)("span",{className:"px-3 py-1 rounded border border-red-600 bg-red-900/25 text-sm font-black text-red-200",children:g("ALLERGY","ALLERGY")}),z&&(0,n.jsx)("span",{className:"px-3 py-1 rounded border border-zinc-600 bg-zinc-950 text-sm font-black text-zinc-200",children:g("PAUSED","PAUSED")}),(0,n.jsx)("span",{className:"px-3 py-1 rounded border border-amber-600 bg-amber-900/30 text-sm font-black text-amber-200",children:g("PENDING","PENDING")})]})}),(0,n.jsx)(x,{pax:s.pax,setup:j,presets:r,dishPresets:i,menus:l,onSetSeatMenu:(e,t)=>a(s.id,e,t),onSetSeatSub:(e,t,n)=>u(s.id,e,t,n),onAddExtraDish:(e,t)=>b(s.id,e,t),onRemoveExtraDish:(e,t)=>m(s.id,e,t),onSetChefNote:e=>p(s.id,e),onInsertCourseLine:(e,t,n)=>v(s.id,e,t,n),onDeleteCourseLine:e=>h(s.id,e),onMoveCourseLine:(e,t)=>f(s.id,e,t)}),(0,n.jsx)("div",{className:"flex items-center justify-end",children:(0,n.jsx)("button",{onClick:N,className:"px-6 py-4 rounded-2xl bg-green-600 hover:bg-green-500 text-black font-black",children:g("APPROVE TABLE","APPROVE TABLE")})})]})}},4774:function(e,t,s){"use strict";s.d(t,{RoleProvider:function(){return l},q:function(){return a}});var n=s(7437),r=s(2265);let i=r.createContext(null);function l(e){let{children:t}=e,[s,l]=r.useState("ROOM"),[a,d]=r.useState(!1);return(0,n.jsx)(i.Provider,{value:{role:s,setRole:l,kitchenAuthed:a,setKitchenAuthed:d},children:t})}function a(){let e=r.useContext(i);if(!e)throw Error("useRole must be used inside RoleProvider");return e}},6463:function(e,t,s){"use strict";var n=s(1169);s.o(n,"usePathname")&&s.d(t,{usePathname:function(){return n.usePathname}}),s.o(n,"useRouter")&&s.d(t,{useRouter:function(){return n.useRouter}})}},function(e){e.O(0,[459,310,376,971,23,744],function(){return e(e.s=3381)}),_N_E=e.O()}]);